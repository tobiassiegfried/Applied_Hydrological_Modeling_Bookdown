aoi_Basin_UTM <- gunt_Shapefile %>% extent() # GUNT, in UTM
# Load the monthly norm precipitation climate
fLoc <- '../HydrologicalModeling_CentralAsia_Data/CentralAsiaDomain/CHELSA_V1.2.1/pbcorr_tp_climatology/CHELSA_V12.nc'
chelsaP_corr_raster <- brick(fLoc, varname="corr_P_annual")
chelsaP_GUNT_corr_raster <- riversCentralAsia::cutRaster2Basin(chelsaP_corr_raster,
aoi_CentralAsia_LatLon,
aoi_Basin_UTM,
"+init=epsg:32642")
chelsaP_GUNT_corr__spdf <- as(chelsaP_GUNT_corr_raster, "SpatialPixelsDataFrame")
chelsaP_GUNT_corr__df <- as.data.frame(chelsaP_GUNT_corr__spdf)
colnames(chelsaP_GUNT_corr__df) <- c("value", "x", "y")
# Plot the raster for inspection and analysis
ggplot() +
geom_tile(data=chelsaP_GUNT_corr__df, aes(x=x, y=y, fill=value), alpha=0.8)+
geom_sf(data=gunt_Shapefile,color="black",fill=NA) +
scale_fill_gradientn(colours = precipitation_colors(5)) +
xlab("Longitude") + ylab("Latitude") +
guides(fill=guide_colorbar(title="P Norm [mm]")) +
ggtitle("Bias Corrected CHELSA v1.2.1 Norm Precipitation, Gunt River Basin")
# Extract raster values inside basin polygon and convert to equivalent water height
rasterRes <- chelsaP_GUNT_corr_raster %>% res()
rasterCellArea <- rasterRes[1] * rasterRes[2] # in m^2
basin_P <- raster::extract(chelsaP_GUNT_corr_raster,gunt_Shapefile)[[1]] * rasterCellArea / 1000
basin_P <- basin_P %>% sum() / areaGunt * 1000 # now in mm
#print(paste0("The bias corrected CHELSA v.1.2 norm precipitation in Gunt River Basin is ", basin_P %>% round(0), ' mm'))
# Get data (this time, we access the monthly norm data)
chelsaP_monthly_corr_raster <- brick(fLoc, varname="corr_P_monthly")
# Crop monthly data to basin domain and reporject to UTM.
chelsaP_GUNT_monthly_corr_raster_proj <- cutRaster2Basin(chelsaP_monthly_corr_raster,
aoi_CentralAsia_LatLon,
aoi_Basin_UTM,
"+init=epsg:32642")
# Extract Gunt river basin cells and compute monthly totals
basin_monthlyP <- extract(chelsaP_GUNT_monthly_corr_raster_proj,gunt_Shapefile)[[1]] * rasterCellArea / 1000
basin_monthlyP <- basin_monthlyP %>% colSums() / areaGunt * 1000 # now in mm
names(basin_monthlyP) <- month.abb
# Load Gunt Station Data record
fPath = '../HydrologicalModeling_CentralAsia_Data/AmuDarya/Gunt/StationData/gunt_data_cleaned.Rds'
data <- read_rds(fPath)
data
P
# Prepare the station data precipitation record
P_38950 <- data %>% filter(type=="P" & code==38950) %>% dplyr::select(date,data) %>% rename(P_38950=data)
P_38953 <- data %>% filter(type=="P" & code==38953) %>% dplyr::select(date,data) %>% rename(P_38953=data)
P_38954 <- data %>% filter(type=="P" & code==38954) %>% dplyr::select(date,data) %>% rename(P_38954=data)
P_38956 <- data %>% filter(type=="P" & code==38956) %>% dplyr::select(date,data) %>% rename(P_38956=data)
P_38950
# Prepare the station data precipitation record
P_38950 <- data %>% filter(type=="P" & code==38950) %>% dplyr::select(date,data) %>% rename(P_38950=data)
P_38953 <- data %>% filter(type=="P" & code==38953) %>% dplyr::select(date,data) %>% rename(P_38953=data)
P_38954 <- data %>% filter(type=="P" & code==38954) %>% dplyr::select(date,data) %>% rename(P_38954=data)
P_38956 <- data %>% filter(type=="P" & code==38956) %>% dplyr::select(date,data) %>% rename(P_38956=data)
P <- full_join(P_38950,P_38953,by="date")
P <- full_join(P,P_38954,by="date")
P <- full_join(P,P_38956,by="date")
P %>% pivot_longer(-date) %>%
filter(date>='1940-01-01') %>%
plot_time_series(date,
value,
name,
.smooth = FALSE,
.x_lab = 'Year',
.y_lab = 'Monthly P [mm]',
.title = "Monthly Precipitation Climatology in Gunt River Basin")
# add a month identifier
P <- P %>%
mutate(mon = month(date))
P
# add a month identifier
P <- P %>% filter(date>=as.Date("1981-01-01") & date<=as.Date("2013-12-31")) %>% mutate(mon = month(date))
P
# Now, make a nice plot which compares with the monthly means at the 4 stations!
mon_normP <- P %>% filter(mon==1) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Jan=value) %>% dplyr::select(-mon)
mon_normP <- mon_normP %>% add_column(P %>% filter(mon==2) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Feb=value) %>% dplyr::select(Feb))
mon_normP <- mon_normP %>% add_column(P %>% filter(mon==3) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Mar=value) %>% dplyr::select(Mar))
mon_normP <- mon_normP %>% add_column(P %>% filter(mon==4) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Apr=value) %>% dplyr::select(Apr))
mon_normP <- mon_normP %>% add_column(P %>% filter(mon==5) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(May=value) %>% dplyr::select(May))
mon_normP <- mon_normP %>% add_column(P %>% filter(mon==6) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Jun=value) %>% dplyr::select(Jun))
mon_normP <- mon_normP %>% add_column(P %>% filter(mon==7) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Jul=value) %>% dplyr::select(Jul))
mon_normP <- mon_normP %>% add_column(P %>% filter(mon==8) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Aug=value) %>% dplyr::select(Aug))
mon_normP <- mon_normP %>% add_column(P %>% filter(mon==9) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Sep=value) %>% dplyr::select(Sep))
mon_normP <- mon_normP %>% add_column(P %>% filter(mon==10) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Oct=value) %>% dplyr::select(Oct))
mon_normP <- mon_normP %>% add_column(P %>% filter(mon==11) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Nov=value) %>% dplyr::select(Nov))
mon_normP <- mon_normP %>% add_column(P %>% filter(mon==12) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Dec=value) %>% dplyr::select(Dec))
basin_monthlyP_complete <- basin_monthlyP %>% t() %>% as_tibble() %>% rename(Jan=X1,Feb=X2,Mar=X3,Apr=X4,May=X5,Jun=X6,Jul=X7,Aug=X8,Sep=X9,Oct=X10,Nov=X11,Dec=X12) %>%
add_column(name = 'PCORR_CHELSA_V1.2',.before=1)
mon_normP
P
# add a month identifier
P <- P %>% filter(date>=as.Date("1981-01-01") & date<=as.Date("2013-12-31")) %>% mutate(mon = month(date)) %>% select(-date)
P <- full_join(P_38950,P_38953,by="date")
P <- full_join(P,P_38954,by="date")
P <- full_join(P,P_38956,by="date")
# add a month identifier
P <- P %>% filter(date>=as.Date("1981-01-01") & date<=as.Date("2013-12-31")) %>% mutate(mon = month(date)) %>% select(-date)
# add a month identifier
P <- P %>% filter(date>=as.Date("1981-01-01") & date<=as.Date("2013-12-31")) %>% mutate(mon = month(date)) %>% dplyr::select(-date)
P
P <- P %>% pivot_longer(-mon)
P
# Get data (this time, we access the monthly norm data through the spacification of the variable name, that we want to load, i.e. varname="corr_P_monthly")
chelsaP_monthly_corr_raster <- brick(fLoc, varname="corr_P_monthly")
# Crop monthly data to basin domain and reporject to UTM.
chelsaP_GUNT_monthly_corr_raster_proj <- cutRaster2Basin(chelsaP_monthly_corr_raster,
aoi_CentralAsia_LatLon,
aoi_Basin_UTM,
"+init=epsg:32642")
# Extract Gunt river basin cells and compute monthly totals
basin_monthlyP <- extract(chelsaP_GUNT_monthly_corr_raster_proj,gunt_Shapefile)[[1]] * rasterCellArea / 1000
basin_monthlyP <- basin_monthlyP %>% colSums() / areaGunt * 1000 # now in mm
names(basin_monthlyP) <- month.abb
# Load Gunt Station Data record
fPath = '../HydrologicalModeling_CentralAsia_Data/AmuDarya/Gunt/StationData/gunt_data_cleaned.Rds'
data <- read_rds(fPath)
# Prepare the station data precipitation record
P_38950 <- data %>% filter(type=="P" & code==38950) %>% dplyr::select(date,data) %>% rename(P_38950=data)
P_38953 <- data %>% filter(type=="P" & code==38953) %>% dplyr::select(date,data) %>% rename(P_38953=data)
P_38954 <- data %>% filter(type=="P" & code==38954) %>% dplyr::select(date,data) %>% rename(P_38954=data)
P_38956 <- data %>% filter(type=="P" & code==38956) %>% dplyr::select(date,data) %>% rename(P_38956=data)
P <- full_join(P_38950,P_38953,by="date")
P <- full_join(P,P_38954,by="date")
P <- full_join(P,P_38956,by="date")
P %>% pivot_longer(-date) %>%
filter(date>='1940-01-01') %>%
plot_time_series(date,
value,
name,
.smooth = FALSE,
.x_lab = 'Year',
.y_lab = 'Monthly P [mm]',
.title = "Monthly Precipitation Climatology in Gunt River Basin")
# add a month identifier
P <- P %>% filter(date>=as.Date("1981-01-01") & date<=as.Date("2013-12-31")) %>% mutate(mon = month(date)) %>% dplyr::select(-date)
P <- P %>% pivot_longer(-mon) %>% group_by(mon)
# Now, make a nice plot which compares with the monthly means at the 4 stations!
#P %>% group_by(mon) %>% summarise(monthlyNormP = mean())
#
# mon_normP <- P %>% filter(mon==1) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Jan=value) %>% dplyr::select(-mon)
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==2) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Feb=value) %>% dplyr::select(Feb))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==3) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Mar=value) %>% dplyr::select(Mar))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==4) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Apr=value) %>% dplyr::select(Apr))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==5) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(May=value) %>% dplyr::select(May))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==6) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Jun=value) %>% dplyr::select(Jun))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==7) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Jul=value) %>% dplyr::select(Jul))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==8) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Aug=value) %>% dplyr::select(Aug))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==9) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Sep=value) %>% dplyr::select(Sep))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==10) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Oct=value) %>% dplyr::select(Oct))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==11) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Nov=value) %>% dplyr::select(Nov))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==12) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Dec=value) %>% dplyr::select(Dec))
# basin_monthlyP_complete <- basin_monthlyP %>% t() %>% as_tibble() %>% rename(Jan=X1,Feb=X2,Mar=X3,Apr=X4,May=X5,Jun=X6,Jul=X7,Aug=X8,Sep=X9,Oct=X10,Nov=X11,Dec=X12) %>%
#   add_column(name = 'PCORR_CHELSA_V1.2',.before=1)
# mon_normP <- mon_normP %>% add_row(basin_monthlyP_complete) %>% rename(source=name)
# # finally, plot!
# mon_normP <- mon_normP %>% pivot_longer(-source) %>% group_by(source)
# mon_normP$name <- factor(mon_normP$name, levels = month.abb)
# mon_normP %>% ggplot(aes(x=name,y=value,color=source)) + geom_point() +
#   xlab("Month") + ylab("Precipitation [mm]")
P
# Now, make a nice plot which compares with the monthly means at the 4 stations!
P %>% group_by(mon) %>% summarise(monthlyNormP = mean(value))
P
# Now, make a nice plot which compares with the monthly means at the 4 stations!
P %>% summarise(monthlyNormP = mean(value))
# Now, make a nice plot which compares with the monthly means at the 4 stations!
P %>% summarise(monthlyNormP = mean(value,na.rm=TRUE))
# Now, make a nice plot which compares with the monthly means average over all stations in the catchment.
monthly_norm_P <- P %>% summarise(monthlyNormP = mean(value,na.rm=TRUE))
# Get data (this time, we access the monthly norm data through the spacification of the variable name, that we want to load, i.e. varname="corr_P_monthly")
chelsaP_monthly_corr_raster <- brick(fLoc, varname="corr_P_monthly")
# Crop monthly data to basin domain and reporject to UTM.
chelsaP_GUNT_monthly_corr_raster_proj <- cutRaster2Basin(chelsaP_monthly_corr_raster,
aoi_CentralAsia_LatLon,
aoi_Basin_UTM,
"+init=epsg:32642")
# Extract Gunt river basin cells and compute monthly totals
chelsa_monthly_norm_P <- extract(chelsaP_GUNT_monthly_corr_raster_proj,gunt_Shapefile)[[1]] * rasterCellArea / 1000
chelsa_monthly_norm_P <- chelsa_monthly_norm_P %>% colSums() / areaGunt * 1000 # now in mm
names(chelsa_monthly_norm_P) <- month.abb
# Load Gunt Station Data record
fPath = '../HydrologicalModeling_CentralAsia_Data/AmuDarya/Gunt/StationData/gunt_data_cleaned.Rds'
data <- read_rds(fPath)
# Prepare the station data precipitation record
P_38950 <- data %>% filter(type=="P" & code==38950) %>% dplyr::select(date,data) %>% rename(P_38950=data)
P_38953 <- data %>% filter(type=="P" & code==38953) %>% dplyr::select(date,data) %>% rename(P_38953=data)
P_38954 <- data %>% filter(type=="P" & code==38954) %>% dplyr::select(date,data) %>% rename(P_38954=data)
P_38956 <- data %>% filter(type=="P" & code==38956) %>% dplyr::select(date,data) %>% rename(P_38956=data)
P <- full_join(P_38950,P_38953,by="date")
P <- full_join(P,P_38954,by="date")
P <- full_join(P,P_38956,by="date")
P %>% pivot_longer(-date) %>%
filter(date>='1940-01-01') %>%
plot_time_series(date,
value,
name,
.smooth = FALSE,
.x_lab = 'Year',
.y_lab = 'Monthly P [mm]',
.title = "Monthly Precipitation Climatology in Gunt River Basin")
# add a month identifier
P <- P %>% filter(date>=as.Date("1981-01-01") & date<=as.Date("2013-12-31")) %>% mutate(mon = month(date)) %>% dplyr::select(-date)
P <- P %>% pivot_longer(-mon) %>% group_by(mon)
# Now, make a nice plot which compares with the monthly means average over all stations in the catchment.
station_monthly_norm_P <- P %>% summarise(monthlyNormP = mean(value,na.rm=TRUE))
#
# mon_normP <- P %>% filter(mon==1) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Jan=value) %>% dplyr::select(-mon)
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==2) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Feb=value) %>% dplyr::select(Feb))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==3) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Mar=value) %>% dplyr::select(Mar))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==4) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Apr=value) %>% dplyr::select(Apr))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==5) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(May=value) %>% dplyr::select(May))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==6) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Jun=value) %>% dplyr::select(Jun))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==7) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Jul=value) %>% dplyr::select(Jul))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==8) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Aug=value) %>% dplyr::select(Aug))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==9) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Sep=value) %>% dplyr::select(Sep))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==10) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Oct=value) %>% dplyr::select(Oct))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==11) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Nov=value) %>% dplyr::select(Nov))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==12) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Dec=value) %>% dplyr::select(Dec))
# basin_monthlyP_complete <- basin_monthlyP %>% t() %>% as_tibble() %>% rename(Jan=X1,Feb=X2,Mar=X3,Apr=X4,May=X5,Jun=X6,Jul=X7,Aug=X8,Sep=X9,Oct=X10,Nov=X11,Dec=X12) %>%
#   add_column(name = 'PCORR_CHELSA_V1.2',.before=1)
# mon_normP <- mon_normP %>% add_row(basin_monthlyP_complete) %>% rename(source=name)
# # finally, plot!
# mon_normP <- mon_normP %>% pivot_longer(-source) %>% group_by(source)
# mon_normP$name <- factor(mon_normP$name, levels = month.abb)
# mon_normP %>% ggplot(aes(x=name,y=value,color=source)) + geom_point() +
#   xlab("Month") + ylab("Precipitation [mm]")
chelsa_monthly_norm_P
chelsa_monthly_norm_P %>% class
station_monthly_norm_P
# Get data (this time, we access the monthly norm data through the spacification of the variable name, that we want to load, i.e. varname="corr_P_monthly")
chelsaP_monthly_corr_raster <- brick(fLoc, varname="corr_P_monthly")
# Crop monthly data to basin domain and reporject to UTM.
chelsaP_GUNT_monthly_corr_raster_proj <- cutRaster2Basin(chelsaP_monthly_corr_raster,
aoi_CentralAsia_LatLon,
aoi_Basin_UTM,
"+init=epsg:32642")
# Extract Gunt river basin cells and compute monthly totals
chelsa_monthly_norm_P <- extract(chelsaP_GUNT_monthly_corr_raster_proj,gunt_Shapefile)[[1]] * rasterCellArea / 1000
chelsa_monthly_norm_P <- chelsa_monthly_norm_P %>% colSums() / areaGunt * 1000 # now in mm
names(chelsa_monthly_norm_P) <- month.abb
# Load Gunt Station Data record
fPath = '../HydrologicalModeling_CentralAsia_Data/AmuDarya/Gunt/StationData/gunt_data_cleaned.Rds'
data <- read_rds(fPath)
# Prepare the station data precipitation record
P_38950 <- data %>% filter(type=="P" & code==38950) %>% dplyr::select(date,data) %>% rename(P_38950=data)
P_38953 <- data %>% filter(type=="P" & code==38953) %>% dplyr::select(date,data) %>% rename(P_38953=data)
P_38954 <- data %>% filter(type=="P" & code==38954) %>% dplyr::select(date,data) %>% rename(P_38954=data)
P_38956 <- data %>% filter(type=="P" & code==38956) %>% dplyr::select(date,data) %>% rename(P_38956=data)
P <- full_join(P_38950,P_38953,by="date")
P <- full_join(P,P_38954,by="date")
P <- full_join(P,P_38956,by="date")
# add a month identifier
P <- P %>% filter(date>=as.Date("1981-01-01") & date<=as.Date("2013-12-31")) %>% mutate(mon = month(date)) %>% dplyr::select(-date)
P <- P %>% pivot_longer(-mon) %>% group_by(mon)
# Now, make a nice plot which compares with the monthly means average over all stations in the catchment.
station_monthly_norm_P <- P %>% summarise(monthlyNormP = mean(value,na.rm=TRUE)) %>% dplyr::select(-mon) %>% as.numeric()
P %>% summarise(monthlyNormP = mean(value,na.rm=TRUE)) %>% dplyr::select(-mon)
P %>% summarise(monthlyNormP = mean(value,na.rm=TRUE)) %>% dplyr::select(-mon) %>% as.numeric()
# Now, make a nice plot which compares with the monthly means average over all stations in the catchment.
station_monthly_norm_P <- P %>% summarise(monthlyNormP = mean(value,na.rm=TRUE)) %>% dplyr::select(-mon) %>%
names(station_monthly_norm_P) <- month.abb
# Now, make a nice plot which compares with the monthly means average over all stations in the catchment.
station_monthly_norm_P <- P %>% summarise(monthlyNormP = mean(value,na.rm=TRUE)) %>% dplyr::select(-mon)
station_monthly_norm_P
# Get data (this time, we access the monthly norm data through the spacification of the variable name, that we want to load, i.e. varname="corr_P_monthly")
chelsaP_monthly_corr_raster <- brick(fLoc, varname="corr_P_monthly")
# Crop monthly data to basin domain and reporject to UTM.
chelsaP_GUNT_monthly_corr_raster_proj <- cutRaster2Basin(chelsaP_monthly_corr_raster,
aoi_CentralAsia_LatLon,
aoi_Basin_UTM,
"+init=epsg:32642")
# Extract Gunt river basin cells and compute monthly totals
chelsa_monthly_norm_P <- extract(chelsaP_GUNT_monthly_corr_raster_proj,gunt_Shapefile)[[1]] * rasterCellArea / 1000
chelsa_monthly_norm_P <- chelsa_monthly_norm_P %>% colSums() / areaGunt * 1000 # now in mm
names(chelsa_monthly_norm_P) <- month.abb %>% as.tibble()
# Load Gunt Station Data record
fPath = '../HydrologicalModeling_CentralAsia_Data/AmuDarya/Gunt/StationData/gunt_data_cleaned.Rds'
data <- read_rds(fPath)
# Prepare the station data precipitation record
P_38950 <- data %>% filter(type=="P" & code==38950) %>% dplyr::select(date,data) %>% rename(P_38950=data)
P_38953 <- data %>% filter(type=="P" & code==38953) %>% dplyr::select(date,data) %>% rename(P_38953=data)
P_38954 <- data %>% filter(type=="P" & code==38954) %>% dplyr::select(date,data) %>% rename(P_38954=data)
P_38956 <- data %>% filter(type=="P" & code==38956) %>% dplyr::select(date,data) %>% rename(P_38956=data)
P <- full_join(P_38950,P_38953,by="date")
P <- full_join(P,P_38954,by="date")
P <- full_join(P,P_38956,by="date")
# add a month identifier
P <- P %>% filter(date>=as.Date("1981-01-01") & date<=as.Date("2013-12-31")) %>% mutate(mon = month(date)) %>% dplyr::select(-date)
P <- P %>% pivot_longer(-mon) %>% group_by(mon)
# Now, make a nice plot which compares with the monthly means average over all stations in the catchment.
station_monthly_norm_P <- P %>% summarise(monthlyNormP = mean(value,na.rm=TRUE)) %>% dplyr::select(-mon)
names(station_monthly_norm_P) <- month.abb
#
# mon_normP <- P %>% filter(mon==1) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Jan=value) %>% dplyr::select(-mon)
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==2) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Feb=value) %>% dplyr::select(Feb))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==3) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Mar=value) %>% dplyr::select(Mar))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==4) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Apr=value) %>% dplyr::select(Apr))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==5) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(May=value) %>% dplyr::select(May))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==6) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Jun=value) %>% dplyr::select(Jun))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==7) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Jul=value) %>% dplyr::select(Jul))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==8) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Aug=value) %>% dplyr::select(Aug))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==9) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Sep=value) %>% dplyr::select(Sep))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==10) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Oct=value) %>% dplyr::select(Oct))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==11) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Nov=value) %>% dplyr::select(Nov))
# mon_normP <- mon_normP %>% add_column(P %>% filter(mon==12) %>% dplyr::select(-date,mon) %>% na.omit() %>% summarise(across(,mean)) %>% pivot_longer(-mon) %>% rename(Dec=value) %>% dplyr::select(Dec))
# basin_monthlyP_complete <- basin_monthlyP %>% t() %>% as_tibble() %>% rename(Jan=X1,Feb=X2,Mar=X3,Apr=X4,May=X5,Jun=X6,Jul=X7,Aug=X8,Sep=X9,Oct=X10,Nov=X11,Dec=X12) %>%
#   add_column(name = 'PCORR_CHELSA_V1.2',.before=1)
# mon_normP <- mon_normP %>% add_row(basin_monthlyP_complete) %>% rename(source=name)
# # finally, plot!
# mon_normP <- mon_normP %>% pivot_longer(-source) %>% group_by(source)
# mon_normP$name <- factor(mon_normP$name, levels = month.abb)
# mon_normP %>% ggplot(aes(x=name,y=value,color=source)) + geom_point() +
#   xlab("Month") + ylab("Precipitation [mm]")
chelsa_monthly_norm_P
# Extract Gunt river basin cells and compute monthly totals
chelsa_monthly_norm_P <- extract(chelsaP_GUNT_monthly_corr_raster_proj,gunt_Shapefile)[[1]] * rasterCellArea / 1000
chelsa_monthly_norm_P <- chelsa_monthly_norm_P %>% colSums() / areaGunt * 1000 # now in mm
chelsa_monthly_norm_P
chelsa_monthly_norm_P %>% class()
# Extract Gunt river basin cells and compute monthly totals
chelsa_monthly_norm_P <- extract(chelsaP_GUNT_monthly_corr_raster_proj,gunt_Shapefile)[[1]] * rasterCellArea / 1000
chelsa_monthly_norm_P <- chelsa_monthly_norm_P %>% colSums() / areaGunt * 1000 %>% unname()# now in mm
chelsa_monthly_norm_P
station_monthly_norm_P
# Now, make a nice plot which compares with the monthly means average over all stations in the catchment.
station_monthly_norm_P <- P %>% summarise(monthlyNormP = mean(value,na.rm=TRUE)) %>% dplyr::select(-mon)
station_monthly_norm_P
# Get data (this time, we access the monthly norm data through the spacification of the variable name, that we want to load, i.e. varname="corr_P_monthly")
chelsaP_monthly_corr_raster <- brick(fLoc, varname="corr_P_monthly")
# Crop monthly data to basin domain and reporject to UTM.
chelsaP_GUNT_monthly_corr_raster_proj <- cutRaster2Basin(chelsaP_monthly_corr_raster,
aoi_CentralAsia_LatLon,
aoi_Basin_UTM,
"+init=epsg:32642")
# Extract Gunt river basin cells and compute monthly totals
chelsa_monthly_norm_P <- extract(chelsaP_GUNT_monthly_corr_raster_proj,gunt_Shapefile)[[1]] * rasterCellArea / 1000
chelsa_monthly_norm_P <- chelsa_monthly_norm_P %>% colSums() / areaGunt * 1000 # now in mm
chelsa_monthly_norm_P <- as_tibble(chelsa_monthly_norm_P = chelsa_monthly_norm_P)
chelsa_monthly_norm_P
chelsa_monthly_norm_P %>% unname
chelsa_monthly_norm_P %>% unname()
# Extract Gunt river basin cells and compute monthly totals
chelsa_monthly_norm_P <- extract(chelsaP_GUNT_monthly_corr_raster_proj,gunt_Shapefile)[[1]] * rasterCellArea / 1000
chelsa_monthly_norm_P <- (chelsa_monthly_norm_P %>% colSums() / areaGunt * 1000) %>% unname() # now in mm
chelsa_monthly_norm_P <- as_tibble(chelsa_monthly_norm_P = chelsa_monthly_norm_P)
# Extract Gunt river basin cells and compute monthly totals
chelsa_monthly_norm_P <- extract(chelsaP_GUNT_monthly_corr_raster_proj,gunt_Shapefile)[[1]] * rasterCellArea / 1000
chelsa_monthly_norm_P <- (chelsa_monthly_norm_P %>% colSums() / areaGunt * 1000) %>% unname() # now in mm
chelsa_monthly_norm_P <- chelsa_monthly_norm_P %>% as_tibble()
chelsa_monthly_norm_P
chelsa_monthly_norm_P <- chelsa_monthly_norm_P %>% as_tibble() %>% rename(CHELSA_norm_P=value)
chelsa_monthly_norm_P
station_monthly_norm_P
# Get data (this time, we access the monthly norm data through the spacification of the variable name, that we want to load, i.e. varname="corr_P_monthly")
chelsaP_monthly_corr_raster <- brick(fLoc, varname="corr_P_monthly")
# Crop monthly data to basin domain and reporject to UTM.
chelsaP_GUNT_monthly_corr_raster_proj <- cutRaster2Basin(chelsaP_monthly_corr_raster,
aoi_CentralAsia_LatLon,
aoi_Basin_UTM,
"+init=epsg:32642")
# Extract Gunt river basin cells and compute monthly totals
chelsa_monthly_norm_P <- extract(chelsaP_GUNT_monthly_corr_raster_proj,gunt_Shapefile)[[1]] * rasterCellArea / 1000
chelsa_monthly_norm_P <- (chelsa_monthly_norm_P %>% colSums() / areaGunt * 1000) %>% unname() # now in mm
chelsa_monthly_norm_P <- chelsa_monthly_norm_P %>% as_tibble() %>% rename(CHELSA_norm_P=value)
# Load Gunt Station Data record
fPath = '../HydrologicalModeling_CentralAsia_Data/AmuDarya/Gunt/StationData/gunt_data_cleaned.Rds'
data <- read_rds(fPath)
# Prepare the station data precipitation record
P_38950 <- data %>% filter(type=="P" & code==38950) %>% dplyr::select(date,data) %>% rename(P_38950=data)
P_38953 <- data %>% filter(type=="P" & code==38953) %>% dplyr::select(date,data) %>% rename(P_38953=data)
P_38954 <- data %>% filter(type=="P" & code==38954) %>% dplyr::select(date,data) %>% rename(P_38954=data)
P_38956 <- data %>% filter(type=="P" & code==38956) %>% dplyr::select(date,data) %>% rename(P_38956=data)
P <- full_join(P_38950,P_38953,by="date")
P <- full_join(P,P_38954,by="date")
P <- full_join(P,P_38956,by="date")
# add a month identifier
P <- P %>% filter(date>=as.Date("1981-01-01") & date<=as.Date("2013-12-31")) %>% mutate(mon = month(date)) %>% dplyr::select(-date)
P <- P %>% pivot_longer(-mon) %>% group_by(mon)
# Now, make a nice plot which compares with the monthly means average over all stations in the catchment.
station_monthly_norm_P <- P %>% summarise(Station_Norm_P = mean(value,na.rm=TRUE)) %>% dplyr::select(-mon)
# Join data
norm_P_data <- chelsa_monthly_norm_P %>% add_column(station_monthly_norm_P)
norm_P_data
norm_P_data %>% Plot()
norm_P_data %>% plot()
?add_column
# Join data
norm_P_data <- chelsa_monthly_norm_P %>% add_column(station_monthly_norm_P,mon=seq(1,12,1))
norm_P_data
# Join data
norm_P_data <- chelsa_monthly_norm_P %>% add_column(station_monthly_norm_P,mon=seq(1,12,1),.before = 1)
norm_P_data
# Join data
norm_P_data <- chelsa_monthly_norm_P %>% add_column(mon=seq(1,12,1),station_monthly_norm_P,.before = 1)
norm_P_data
# Prepare for plotting
norm_P_data_long <- norm_P_data %>% pivot_longer(-mon)
norm_P_data_long
?aes
# Plot
ggplot(norm_P_data_long,aes(x=mon,y=value)) + geom_line()
# Plot
ggplot(norm_P_data_long,aes(x=mon,y=value,color = name)) + geom_line()
# Join data
norm_P_data <- chelsa_monthly_norm_P %>% add_column(mon=month.abb,station_monthly_norm_P,.before = 1)
norm_P_data
# Prepare for plotting
norm_P_data_long <- norm_P_data %>% pivot_longer(-mon)
# Plot
ggplot(norm_P_data_long,aes(x=mon,y=value,color = name)) + geom_line()
norm_P_data_long
# Join data
norm_P_data <- chelsa_monthly_norm_P %>% add_column(mon=seq(1,12,1),station_monthly_norm_P,.before = 1)
# Prepare for plotting
norm_P_data_long <- norm_P_data %>% pivot_longer(-mon)
# Plot
ggplot(norm_P_data_long,aes(x=mon,y=value,color = name)) + geom_line()
# Plot
ggplot(norm_P_data_long,aes(x=mon,y=value,color = name)) + geom_line() +
ggtitle("Comparison of Precipitation Norms") + xlab("Month") + ylan("mm/month")
# Plot
ggplot(norm_P_data_long,aes(x=mon,y=value,color = name)) + geom_line() +
ggtitle("Comparison of Precipitation Norms") + xlab("Month") + ylab("mm/month")
norm_P_data_long
norm_P_data
mean_station <- norm_P_data$Station_Norm_P %>% mean()
mean_station
norm_P_data %>% mutate(Station_Norm_P_zscore = (Station_Norm_P - mean(Station_Norm_P)/ sd(Station_Norm_P)) %>%
CHELSA_norm_P_zscore = (CHELSA_norm_P - mean(CHELSA_norm_P)) / sd(CHELSA_norm_P)
norm_P_data %>% mutate(Station_Norm_P_zscore = (Station_Norm_P - mean(Station_Norm_P)/ sd(Station_Norm_P)) %>%
mutate(CHELSA_norm_P_zscore = (CHELSA_norm_P - mean(CHELSA_norm_P)) / sd(CHELSA_norm_P))
norm_P_data %>% mutate(Station_Norm_P_zscore = (Station_Norm_P - mean(Station_Norm_P)/ sd(Station_Norm_P)) %>%
mutate(CHELSA_norm_P_zscore = (CHELSA_norm_P - mean(CHELSA_norm_P)) / sd(CHELSA_norm_P)))
norm_P_data %>% mutate(Station_Norm_P_zscore = (Station_Norm_P - mean(Station_Norm_P)/ sd(Station_Norm_P))) %>%
mutate(CHELSA_norm_P_zscore = (CHELSA_norm_P - mean(CHELSA_norm_P)) / sd(CHELSA_norm_P)))
norm_P_data %>% mutate(Station_Norm_P_zscore = (Station_Norm_P - mean(Station_Norm_P)/ sd(Station_Norm_P)))
norm_P_data %>% mutate(Station_Norm_P_zscore = (Station_Norm_P - mean(Station_Norm_P))/ sd(Station_Norm_P)) %>%
mutate(CHELSA_norm_P_zscore = (CHELSA_norm_P - mean(CHELSA_norm_P)) / sd(CHELSA_norm_P))
# Get data (this time, we access the monthly norm data through the spacification of the variable name, that we want to load, i.e. varname="corr_P_monthly")
chelsaP_monthly_corr_raster <- brick(fLoc, varname="corr_P_monthly")
# Crop monthly data to basin domain and reporject to UTM.
chelsaP_GUNT_monthly_corr_raster_proj <- cutRaster2Basin(chelsaP_monthly_corr_raster,
aoi_CentralAsia_LatLon,
aoi_Basin_UTM,
"+init=epsg:32642")
# Extract Gunt river basin cells and compute monthly totals
chelsa_monthly_norm_P <- extract(chelsaP_GUNT_monthly_corr_raster_proj,gunt_Shapefile)[[1]] * rasterCellArea / 1000
chelsa_monthly_norm_P <- (chelsa_monthly_norm_P %>% colSums() / areaGunt * 1000) %>% unname() # now in mm
chelsa_monthly_norm_P <- chelsa_monthly_norm_P %>% as_tibble() %>% rename(CHELSA_norm_P=value)
# Load Gunt Station Data record
fPath = '../HydrologicalModeling_CentralAsia_Data/AmuDarya/Gunt/StationData/gunt_data_cleaned.Rds'
data <- read_rds(fPath)
# Prepare the station data precipitation record
P_38950 <- data %>% filter(type=="P" & code==38950) %>% dplyr::select(date,data) %>% rename(P_38950=data)
P_38953 <- data %>% filter(type=="P" & code==38953) %>% dplyr::select(date,data) %>% rename(P_38953=data)
P_38954 <- data %>% filter(type=="P" & code==38954) %>% dplyr::select(date,data) %>% rename(P_38954=data)
P_38956 <- data %>% filter(type=="P" & code==38956) %>% dplyr::select(date,data) %>% rename(P_38956=data)
P <- full_join(P_38950,P_38953,by="date")
P <- full_join(P,P_38954,by="date")
P <- full_join(P,P_38956,by="date")
# add a month identifier
P <- P %>% filter(date>=as.Date("1981-01-01") & date<=as.Date("2013-12-31")) %>% mutate(mon = month(date)) %>% dplyr::select(-date)
P <- P %>% pivot_longer(-mon) %>% group_by(mon)
# Now, make a nice plot which compares with the monthly means average over all stations in the catchment.
station_monthly_norm_P <- P %>% summarise(Station_norm_P = mean(value,na.rm=TRUE)) %>% dplyr::select(-mon)
# Join data
norm_P_data <- chelsa_monthly_norm_P %>% add_column(mon=seq(1,12,1),station_monthly_norm_P,.before = 1)
# Prepare for plotting
norm_P_data_long <- norm_P_data %>% pivot_longer(-mon)
# Plot
ggplot(norm_P_data_long,aes(x=mon,y=value,color = name)) + geom_line() +
xlab("Month") + ylab("mm/month")
norm_P_data_zscore <-
norm_P_data %>% mutate(Station_norm_P_zscore = (Station_norm_P - mean(Station_norm_P))/ sd(Station_norm_P)) %>%
mutate(CHELSA_norm_P_zscore = (CHELSA_norm_P - mean(CHELSA_norm_P)) / sd(CHELSA_norm_P))
norm_P_data_zscore_long <- norm_P_data_zscore %>% dplyr::select(-Station_norm_P,-CHELSA_norm_P) %>% pivot_longer(-mon)
ggplot(norm_P_data_zscore_long,aes(x=mon,y=value,color = name)) + geom_line() +
xlab("Month") + ylab("mm/month")
knitr::include_graphics("_bookdown_files/FIG_DATA/lobelia_era5.jpg")
knitr::include_graphics('_bookdown_files/FIG_DATA/CDStore_ERA5.jpg')
basinName <- 'Gunt'
dataType_ERA5 <- 'tp' # note that ERA5 tp units are in m!
## Directories of relevant climate files  - function arguments
dir_ERA5_daily <- '../HydrologicalModeling_CentralAsia_Data/CentralAsiaDomain/ERA5/' # Note: ERA5 data in m
# basin
basin_shp_latlon <- gunt_Shapefile_LatLon
# start and end times - function arguments
startY <- 1981
endY <- 2013
# Date sequence
sTime <- paste0(startY,'-01-01 01:00:00')
eTime <- paste0(endY,'-12-31 23:00:00')
dateSeq_ERA <- seq(as.POSIXct(sTime), as.POSIXct(eTime), by="hour")
dateSeq_ERA <- tibble(date=dateSeq_ERA, data=NA)
dateSeq_ERA <- dateSeq_ERA %>% mutate(month = month(date)) %>% mutate(year = year(date))
# Create Basin subdirectory (if not already existing) to store dedicated annual files there
mainDir <- paste0(dir_ERA5_daily,dataType_ERA5,'/',basinName,'/')
mainDir
knitr::include_graphics('_bookdown_files/FIG_DATA/Comparison_ERA5rescaled_Station_tp_monthly.jpg')
?biasCorrect_ERA5_CHELSA
knitr::include_graphics("_bookdown_files/FIG_DATA/Gunt_Outline.jpg")
```{r guntSubbasins, fig.cap='Gunt river catchment with the individual subbasins is shown. These subbasins are further divided into elevation band zones and the mean climate finally extracted over these subbasin-specfic elevation bands.'}
knitr::include_graphics("_bookdown_files/FIG_DATA/Gunt_Subbasins.jpg")
knitr::include_graphics("_bookdown_files/FIG_DATA/Gunt_Subbasins_ElevationBands.jpg")
# Housekeeping
dir_ERA5 <- '../HydrologicalModeling_CentralAsia_Data/CentralAsiaDomain/ERA5/'
catchmentName <- 'Gunt'
elBands_shp <- st_read('../HydrologicalModeling_CentralAsia_Data/AmuDarya/Gunt/GeospatialData/Gunt_ElevationBands_Subbasins_RSMinerve.shp')
elBands_shp
knitr::include_graphics('_bookdown_files/FIG_DATA/Gunt_Topology.jpg')
knitr::include_graphics('_bookdown_files/FIG_DATA/Gunt_ElevationBands_AttributeTable.jpg')
?generate_ERA5_Subbasin_CSV
knitr::include_graphics("_bookdown_files/FIG_DATA/gunt_RSMINERVE_CSV.jpg")
options(knitr.duplicate.label = "allow")
