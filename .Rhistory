p4 <- q4TP %>% na.omit() %>% ggplot(aes(x=T,y=P)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
p <- list(p1,p4)
cowplot::plot_grid(plotlist = p,nrow = 1,ncol = 4)
q1TP <- left_join(q1T ,q1P ,by=c('date','name')) %>% rename(T=value.x,P=value.y)
p1 <- q1TP %>% na.omit() %>% ggplot(aes(x=T,y=P)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
q2TP <- left_join(q2T ,q2P ,by=c('date','name')) %>% rename(T=value.x,P=value.y)
p2 <- q2TP %>% na.omit() %>% ggplot(aes(x=T,y=P)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
q3TP <- left_join(q3T ,q3P ,by=c('date','name')) %>% rename(T=value.x,P=value.y)
p3 <- q3TP %>% na.omit() %>% ggplot(aes(x=T,y=P)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
q4TP <- left_join(q4T ,q4P ,by=c('date','name')) %>% rename(T=value.x,P=value.y)
p4 <- q4TP %>% na.omit() %>% ggplot(aes(x=T,y=P)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
p <- list(p1,p4)
cowplot::plot_grid(plotlist = p,nrow = 1,ncol = 2)
q1TP <- left_join(q1T ,q1P ,by=c('date','name')) %>% rename(T=value.x,P=value.y)
p1 <- q1TP %>% na.omit() %>% ggplot(aes(x=T,y=P)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q2TP <- left_join(q2T ,q2P ,by=c('date','name')) %>% rename(T=value.x,P=value.y)
p2 <- q2TP %>% na.omit() %>% ggplot(aes(x=T,y=P)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q3TP <- left_join(q3T ,q3P ,by=c('date','name')) %>% rename(T=value.x,P=value.y)
p3 <- q3TP %>% na.omit() %>% ggplot(aes(x=T,y=P)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q4TP <- left_join(q4T ,q4P ,by=c('date','name')) %>% rename(T=value.x,P=value.y)
p4 <- q4TP %>% na.omit() %>% ggplot(aes(x=T,y=P)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
p <- list(p1,p4)
cowplot::plot_grid(plotlist = p,nrow = 1,ncol = 2)
q1TQ <- left_join(q1T ,q1Q ,by=c('date','name')) %>% rename(T=value.x,P=value.y)
p1 <- q1TQ %>% na.omit() %>% ggplot(aes(x=T,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q2TQ <- left_join(q2T ,q2Q ,by=c('date','name')) %>% rename(T=value.x,P=value.y)
p2 <- q2TQ %>% na.omit() %>% ggplot(aes(x=T,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q3TQ <- left_join(q3T ,q3Q ,by=c('date','name')) %>% rename(T=value.x,P=value.y)
p3 <- q3TQ %>% na.omit() %>% ggplot(aes(x=T,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q4TQ <- left_join(q4T ,q4Q ,by=c('date','name')) %>% rename(T=value.x,P=value.y)
p4 <- q4TQ %>% na.omit() %>% ggplot(aes(x=T,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
p <- list(p1,p4)
cowplot::plot_grid(plotlist = p,nrow = 1,ncol = 2)
q1TQ
q1TQ <- left_join(q1T ,q1Q ,by=c('date','name')) %>% rename(T=value.x,Q=value.y)
p1 <- q1TQ %>% na.omit() %>% ggplot(aes(x=T,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q2TQ <- left_join(q2T ,q2Q ,by=c('date','name')) %>% rename(T=value.x,Q=value.y)
p2 <- q2TQ %>% na.omit() %>% ggplot(aes(x=T,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q3TQ <- left_join(q3T ,q3Q ,by=c('date','name')) %>% rename(T=value.x,Q=value.y)
p3 <- q3TQ %>% na.omit() %>% ggplot(aes(x=T,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q4TQ <- left_join(q4T ,q4Q ,by=c('date','name')) %>% rename(T=value.x,Q=value.y)
p4 <- q4TQ %>% na.omit() %>% ggplot(aes(x=T,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
p <- list(p1,p4)
cowplot::plot_grid(plotlist = p,nrow = 1,ncol = 2)
q1TQ <- left_join(q1T ,q1Q ,by=c('date','name')) %>% rename(T=value.x,Q=value.y)
p1 <- q1TQ %>% na.omit() %>% ggplot(aes(x=T,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q2TQ <- left_join(q2T ,q2Q ,by=c('date','name')) %>% rename(T=value.x,Q=value.y)
p2 <- q2TQ %>% na.omit() %>% ggplot(aes(x=T,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q3TQ <- left_join(q3T ,q3Q ,by=c('date','name')) %>% rename(T=value.x,Q=value.y)
p3 <- q3TQ %>% na.omit() %>% ggplot(aes(x=T,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q4TQ <- left_join(q4T ,q4Q ,by=c('date','name')) %>% rename(T=value.x,Q=value.y)
p4 <- q4TQ %>% na.omit() %>% ggplot(aes(x=T,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
p <- list(p1,p4)
cowplot::plot_grid(plotlist = p,nrow = 1,ncol = 2)
q1PQ <- left_join(q1P,q1Q ,by=c('date','name')) %>% rename(P=value.x,Q=value.y)
p1 <- q1PQ %>% na.omit() %>% ggplot(aes(x=P,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q2PQ <- left_join(q2P,q2Q ,by=c('date','name')) %>% rename(P=value.x,Q=value.y)
p2 <- q2PQ %>% na.omit() %>% ggplot(aes(x=P,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q3PQ <- left_join(q3P,q3Q ,by=c('date','name')) %>% rename(P=value.x,Q=value.y)
p3 <- q3PQ %>% na.omit() %>% ggplot(aes(x=P,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q4PQ <- left_join(q4P,q4Q ,by=c('date','name')) %>% rename(P=value.x,Q=value.y)
p4 <- q4PQ %>% na.omit() %>% ggplot(aes(x=P,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
p <- list(p1,p4)
cowplot::plot_grid(plotlist = p,nrow = 1,ncol = 2)
q1PQ <- left_join(q1P,q1Q ,by=c('date','name')) %>% rename(P=value.x,Q=value.y)
p1 <- q1PQ %>% na.omit() %>% ggplot(aes(x=P,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q2PQ <- left_join(q2P,q2Q ,by=c('date','name')) %>% rename(P=value.x,Q=value.y)
p2 <- q2PQ %>% na.omit() %>% ggplot(aes(x=P,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q3PQ <- left_join(q3P,q3Q ,by=c('date','name')) %>% rename(P=value.x,Q=value.y)
p3 <- q3PQ %>% na.omit() %>% ggplot(aes(x=P,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q4PQ <- left_join(q4P,q4Q ,by=c('date','name')) %>% rename(P=value.x,Q=value.y)
p4 <- q4PQ %>% na.omit() %>% ggplot(aes(x=P,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
p <- list(p1,p2,p3,p4)
cowplot::plot_grid(plotlist = p,nrow = 1,ncol = 2)
q1PQ <- left_join(q1P,q1Q ,by=c('date','name')) %>% rename(P=value.x,Q=value.y)
p1 <- q1PQ %>% na.omit() %>% ggplot(aes(x=P,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q2PQ <- left_join(q2P,q2Q ,by=c('date','name')) %>% rename(P=value.x,Q=value.y)
p2 <- q2PQ %>% na.omit() %>% ggplot(aes(x=P,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q3PQ <- left_join(q3P,q3Q ,by=c('date','name')) %>% rename(P=value.x,Q=value.y)
p3 <- q3PQ %>% na.omit() %>% ggplot(aes(x=P,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
q4PQ <- left_join(q4P,q4Q ,by=c('date','name')) %>% rename(P=value.x,Q=value.y)
p4 <- q4PQ %>% na.omit() %>% ggplot(aes(x=P,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
p <- list(p1,p2,p3,p4)
cowplot::plot_grid(plotlist = p,nrow = 1,ncol = 4)
q1QQ <- left_join(q1Q,qwQ ,by=c('date','name')) %>% rename(Q1=value.x,Q2=value.y)
q1QQ <- left_join(q1Q,q2Q ,by=c('date','name')) %>% rename(Q1=value.x,Q2=value.y)
p1 <- q1QQ %>% na.omit() %>% ggplot(aes(x=P,y=Q)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
p1
q1QQ <- left_join(q1Q,q2Q ,by=c('date','name')) %>% rename(Q1=value.x,Q2=value.y)
p1 <- q1QQ %>% na.omit() %>% ggplot(aes(x=Q1,y=Q2)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
p1
q1QQ
q1Q
q2Q
q1QQ <- q1Q %>% add_column(Q2=q2Q$value) rename(Q1=value.x)
q1QQ <- q1Q %>% add_column(Q2=q2Q$value) %>%  rename(Q1=value.x)
q1Q %>% add_column(Q2=q2Q$value)
q1QQ <- q1Q %>% add_column(Q2=q2Q$value) %>%  rename(Q1=value)
p1 <- q1QQ %>% na.omit() %>% ggplot(aes(x=Q1,y=Q2)) + geom_point() + geom_smooth(formula = y ~ x,method = "lm")
p1
q1QQ <- q1Q %>% add_column(Q2=q2Q$value) %>%  rename(Q1=value)
p1 <- q1QQ %>% na.omit() %>% ggplot(aes(x=Q1,y=Q2)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
p1
q1QQ <- q1Q %>% add_column(Q2=q2Q$value) %>%  rename(Q1=value)
p1 <- q1QQ %>% na.omit() %>% ggplot(aes(x=Q1,y=Q2)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
p1
q2QQ <- q2Q %>% add_column(Q3=q3Q$value) %>%  rename(Q2=value)
p2 <- q2QQ %>% na.omit() %>% ggplot(aes(x=Q2,y=Q3)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
p2
q1QQ <- q1Q %>% add_column(Q2=q2Q$value) %>%  rename(Q1=value)
p1 <- q1QQ %>% na.omit() %>% ggplot(aes(x=Q1,y=Q2)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
q2QQ <- q2Q %>% add_column(Q3=q3Q$value) %>%  rename(Q2=value)
p2 <- q2QQ %>% na.omit() %>% ggplot(aes(x=Q2,y=Q3)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
q3QQ <- q3Q %>% add_column(Q4=q4Q$value) %>%  rename(Q3=value)
q1QQ <- q1Q %>% add_column(Q2=q2Q$value) %>%  rename(Q1=value)
p1 <- q1QQ %>% na.omit() %>% ggplot(aes(x=Q1,y=Q2)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
q2QQ <- q2Q %>% add_column(Q3=q3Q$value) %>%  rename(Q2=value)
p2 <- q2QQ %>% na.omit() %>% ggplot(aes(x=Q2,y=Q3)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
# q3QQ <- q3Q %>% add_column(Q4=q4Q$value) %>%  rename(Q3=value)
# p3 <- q3QQ %>% na.omit() %>% ggplot(aes(x=Q3,y=Q4)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
p <- list(p1,p2)
cowplot::plot_grid(plotlist = p,nrow = 1,ncol = 2)
q1QQ <- q1Q %>% add_column(Q2=q2Q$value) %>%  rename(Q1=value)
p1 <- q1QQ %>% na.omit() %>% ggplot(aes(x=Q1,y=Q2)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess") +
stat_smooth_func(geom="text",method="lm",hjust=0,parse=TRUE) +
q2QQ <- q2Q %>% add_column(Q3=q3Q$value) %>%  rename(Q2=value)
q1QQ <- q1Q %>% add_column(Q2=q2Q$value) %>%  rename(Q1=value)
p1 <- q1QQ %>% na.omit() %>% ggplot(aes(x=Q1,y=Q2)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess") +
stat_smooth_func(geom="text",method="lm",hjust=0,parse=TRUE)
q1QQ <- q1Q %>% add_column(Q2=q2Q$value) %>%  rename(Q1=value)
p1 <- q1QQ %>% na.omit() %>% ggplot(aes(x=Q1,y=Q2)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
q2QQ <- q2Q %>% add_column(Q3=q3Q$value) %>%  rename(Q2=value)
p2 <- q2QQ %>% na.omit() %>% ggplot(aes(x=Q2,y=Q3)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
# q3QQ <- q3Q %>% add_column(Q4=q4Q$value) %>%  rename(Q3=value)
# p3 <- q3QQ %>% na.omit() %>% ggplot(aes(x=Q3,y=Q4)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
p <- list(p1,p2)
cowplot::plot_grid(plotlist = p,nrow = 1,ncol = 2)
quarterQ_mean <- data %>% filter(type == "Q" & code=="16924") %>%
dplyr::select(date,data,code,river)  %>%
summarise_by_time(.date_var = date,.by = "quarter",value = mean(data,na.rm = TRUE)) %>%
rename(mean = value) #%>% na.omit()
quarterQ_max <- data %>% filter(type == "Q" & code=="16924") %>%
dplyr::select(date,data,code,river)  %>%
summarise_by_time(.date_var = date, .by = "quarter", value = max(data,na.rm = TRUE)) %>%
rename(max = value) #%>% na.omit()
quarterQ_min <- data %>% filter(type == "Q" & code=="16924") %>%
dplyr::select(date,data,code,river)  %>%
summarise_by_time(.date_var = date, .by = "quarter", value = min(data,na.rm = TRUE)) %>%
rename(min = value) #%>% na.omit()
quarterQ <- left_join(quarterQ_mean,quarterQ_max,by='date')
quarterQ <- left_join(quarterQ,quarterQ_min,by='date')
quarterQ <- bind_cols(quarterQ,quarterQ$date %>% tsibble::yearquarter()) %>% rename(quarter='...5')
quarterQ$quarter <- quarterQ$quarter %>% format(.,format = "Q%q")
q1Q <- quarterQ %>% filter(quarter=='Q1') %>% select(-quarter) %>% pivot_longer(-date)
q2Q <- quarterQ %>% filter(quarter=='Q2') %>% select(-quarter) %>% pivot_longer(-date)
q3Q <- quarterQ %>% filter(quarter=='Q3') %>% select(-quarter) %>% pivot_longer(-date)
q4Q <- quarterQ %>% filter(quarter=='Q4') %>% select(-quarter) %>% pivot_longer(-date)
pQ1 <- q1Q  %>% #group_by(name) %>%
plot_time_series(date,value,name,
.smooth = T, .smooth_degree = 1, .smooth_period = 'auto',
.title = "", .interactive = F, .facet_ncol = 1,
.x_lab = "year", .y_lab = "Q", .legend_show = T
) + theme(legend.position = c(0.1, 0.8))
pQ2 <- q2Q  %>% #group_by(name) %>%
plot_time_series(date,value,name,
.smooth = T, .smooth_degree = 1, .smooth_period = 'auto',
.title = "", .interactive = F, .facet_ncol = 1,
.x_lab = "year",.y_lab = "Q", .legend_show = F
) #+ theme(legend.position = c(0.1, 0.8))
pQ3 <- q3Q  %>% #group_by(name) %>%
plot_time_series(date,value,name,
.smooth = T, .smooth_degree = 1, .smooth_period = 'auto',
.title = "", .interactive = F, .facet_ncol = 1,
.x_lab = "year",.y_lab = "Q",.legend_show = F
) #+ theme(legend.position = c(0.1, 0.8))
pQ4 <- q4Q  %>% na.omit() %>% #group_by(name) %>%
plot_time_series(date,value,name,
.smooth = T, .smooth_degree = 1, .smooth_period = 'auto',
.title = "", .interactive = F, .facet_ncol = 1,
.x_lab = "year",.y_lab = "Q",.legend_show = F
) #+ theme(legend.position = c(0.1, 0.8))
q1Q
q2Q
q3Q
q4Q
quarterQ_mean <- data %>% filter(type == "Q" & code=="16924") %>%
dplyr::select(date,data,code,river)  %>%
summarise_by_time(.date_var = date,.by = "quarter",value = mean(data,na.rm = TRUE)) %>%
rename(mean = value) #%>% na.omit()
quarterQ_max <- data %>% filter(type == "Q" & code=="16924") %>%
dplyr::select(date,data,code,river)  %>%
summarise_by_time(.date_var = date, .by = "quarter", value = max(data,na.rm = TRUE)) %>%
rename(max = value) #%>% na.omit()
quarterQ_min <- data %>% filter(type == "Q" & code=="16924") %>%
dplyr::select(date,data,code,river)  %>%
summarise_by_time(.date_var = date, .by = "quarter", value = min(data,na.rm = TRUE)) %>%
rename(min = value) #%>% na.omit()
quarterQ <- left_join(quarterQ_mean,quarterQ_max,by='date')
quarterQ <- left_join(quarterQ,quarterQ_min,by='date')
quarterQ <- bind_cols(quarterQ,quarterQ$date %>% tsibble::yearquarter()) %>% rename(quarter='...5')
quarterQ$quarter <- quarterQ$quarter %>% format(.,format = "Q%q")
q1Q <- quarterQ %>% filter(quarter=='Q1') %>% select(-quarter) %>% pivot_longer(-date)
q2Q <- quarterQ %>% filter(quarter=='Q2') %>% select(-quarter) %>% pivot_longer(-date)
q3Q <- quarterQ %>% filter(quarter=='Q3') %>% select(-quarter) %>% pivot_longer(-date)
q4Q <- quarterQ %>% filter(quarter=='Q4') %>% select(-quarter) %>% pivot_longer(-date)
pQ1 <- q1Q  %>% na.omit() %>% #group_by(name) %>%
plot_time_series(date,value,name,
.smooth = T, .smooth_degree = 1, .smooth_period = 'auto',
.title = "", .interactive = F, .facet_ncol = 1,
.x_lab = "year", .y_lab = "Q", .legend_show = T
) + theme(legend.position = c(0.1, 0.8))
pQ2 <- q2Q  %>% na.omit() %>%#group_by(name) %>%
plot_time_series(date,value,name,
.smooth = T, .smooth_degree = 1, .smooth_period = 'auto',
.title = "", .interactive = F, .facet_ncol = 1,
.x_lab = "year",.y_lab = "Q", .legend_show = F
) #+ theme(legend.position = c(0.1, 0.8))
pQ3 <- q3Q  %>% na.omit() %>%#group_by(name) %>%
plot_time_series(date,value,name,
.smooth = T, .smooth_degree = 1, .smooth_period = 'auto',
.title = "", .interactive = F, .facet_ncol = 1,
.x_lab = "year",.y_lab = "Q",.legend_show = F
) #+ theme(legend.position = c(0.1, 0.8))
pQ4 <- q4Q  %>% na.omit() %>% #group_by(name) %>%
plot_time_series(date,value,name,
.smooth = T, .smooth_degree = 1, .smooth_period = 'auto',
.title = "", .interactive = F, .facet_ncol = 1,
.x_lab = "year",.y_lab = "Q",.legend_show = F
) #+ theme(legend.position = c(0.1, 0.8))
?summarize_by_time
quarterQ
quarterQ_mean <- data %>% filter(type == "Q" & code=="16924") %>%
dplyr::select(date,data,code,river)  %>%
summarise_by_time(.date_var = date,.by = "quarter",value = mean(data,na.rm = TRUE)) %>%
rename(mean = value) #%>% na.omit()
quarterQ_max <- data %>% filter(type == "Q" & code=="16924") %>%
dplyr::select(date,data,code,river)  %>%
summarise_by_time(.date_var = date, .by = "quarter", value = max(data,na.rm = TRUE)) %>%
rename(max = value) #%>% na.omit()
quarterQ_min <- data %>% filter(type == "Q" & code=="16924") %>%
dplyr::select(date,data,code,river)  %>%
summarise_by_time(.date_var = date, .by = "quarter", value = min(data,na.rm = TRUE)) %>%
rename(min = value) #%>% na.omit()
quarterQ <- left_join(quarterQ_mean,quarterQ_max,by='date')
quarterQ <- left_join(quarterQ,quarterQ_min,by='date')
quarterQ <- bind_cols(quarterQ,quarterQ$date %>% tsibble::yearquarter()) %>% rename(quarter='...5')
quarterQ$quarter <- quarterQ$quarter %>% format(.,format = "Q%q")
q1Q <- quarterQ %>% filter(quarter=='Q1') %>% select(-quarter) %>% na.omit() %>%pivot_longer(-date)
q2Q <- quarterQ %>% filter(quarter=='Q2') %>% select(-quarter) %>% na.omit() %>%pivot_longer(-date)
q3Q <- quarterQ %>% filter(quarter=='Q3') %>% select(-quarter) %>% na.omit() %>%pivot_longer(-date)
q4Q <- quarterQ %>% filter(quarter=='Q4') %>% select(-quarter) %>% na.omit() %>%pivot_longer(-date)
pQ1 <- q1Q  %>% na.omit() %>% #group_by(name) %>%
plot_time_series(date,value,name,
.smooth = T, .smooth_degree = 1, .smooth_period = 'auto',
.title = "", .interactive = F, .facet_ncol = 1,
.x_lab = "year", .y_lab = "Q", .legend_show = T
) + theme(legend.position = c(0.1, 0.8))
pQ2 <- q2Q  %>% na.omit() %>%#group_by(name) %>%
plot_time_series(date,value,name,
.smooth = T, .smooth_degree = 1, .smooth_period = 'auto',
.title = "", .interactive = F, .facet_ncol = 1,
.x_lab = "year",.y_lab = "Q", .legend_show = F
) #+ theme(legend.position = c(0.1, 0.8))
pQ3 <- q3Q  %>% na.omit() %>%#group_by(name) %>%
plot_time_series(date,value,name,
.smooth = T, .smooth_degree = 1, .smooth_period = 'auto',
.title = "", .interactive = F, .facet_ncol = 1,
.x_lab = "year",.y_lab = "Q",.legend_show = F
) #+ theme(legend.position = c(0.1, 0.8))
pQ4 <- q4Q  %>% na.omit() %>% #group_by(name) %>%
plot_time_series(date,value,name,
.smooth = T, .smooth_degree = 1, .smooth_period = 'auto',
.title = "", .interactive = F, .facet_ncol = 1,
.x_lab = "year",.y_lab = "Q",.legend_show = F
) #+ theme(legend.position = c(0.1, 0.8))
plotM <- list(pQ1,pQ2,pQ3,pQ4)
cowplot::plot_grid(plotlist = plotM, nrow = 1, ncol = 4)
q1Q
q2Q
q3Q
q4Q
q1QQ <- q1Q %>% add_column(Q2=q2Q$value) %>%  rename(Q1=value)
p1 <- q1QQ %>% na.omit() %>% ggplot(aes(x=Q1 %>% log1p(),y=Q2 %>% log1p())) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
q2QQ <- q2Q %>% add_column(Q3=q3Q$value) %>%  rename(Q2=value)
p2 <- q2QQ %>% na.omit() %>% ggplot(aes(x=Q2,y=Q3)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
# q3QQ <- q3Q %>% add_column(Q4=q4Q$value) %>%  rename(Q3=value)
# p3 <- q3QQ %>% na.omit() %>% ggplot(aes(x=Q3,y=Q4)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
p <- list(p1,p2)
cowplot::plot_grid(plotlist = p,nrow = 1,ncol = 2)
q1QQ <- q1Q %>% add_column(Q2=q2Q$value) %>%  rename(Q1=value)
p1 <- q1QQ %>% na.omit() %>% ggplot(aes(x=Q1 %>% log1p(),y=Q2) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
q2QQ <- q2Q %>% add_column(Q3=q3Q$value) %>%  rename(Q2=value)
q1QQ <- q1Q %>% add_column(Q2=q2Q$value) %>%  rename(Q1=value)
p1 <- q1QQ %>% na.omit() %>% ggplot(aes(x=Q1 %>% log1p(),y=Q2)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
q2QQ <- q2Q %>% add_column(Q3=q3Q$value) %>%  rename(Q2=value)
p2 <- q2QQ %>% na.omit() %>% ggplot(aes(x=Q2,y=Q3)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
# q3QQ <- q3Q %>% add_column(Q4=q4Q$value) %>%  rename(Q3=value)
# p3 <- q3QQ %>% na.omit() %>% ggplot(aes(x=Q3,y=Q4)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
p <- list(p1,p2)
cowplot::plot_grid(plotlist = p,nrow = 1,ncol = 2)
q1QQ <- q1Q %>% add_column(Q2=q2Q$value) %>%  rename(Q1=value)
p1 <- q1QQ %>% na.omit() %>% ggplot(aes(x=Q1,y=Q2 %>% log1p())) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
q2QQ <- q2Q %>% add_column(Q3=q3Q$value) %>%  rename(Q2=value)
p2 <- q2QQ %>% na.omit() %>% ggplot(aes(x=Q2,y=Q3)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
# q3QQ <- q3Q %>% add_column(Q4=q4Q$value) %>%  rename(Q3=value)
# p3 <- q3QQ %>% na.omit() %>% ggplot(aes(x=Q3,y=Q4)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
p <- list(p1,p2)
cowplot::plot_grid(plotlist = p,nrow = 1,ncol = 2)
q1QQ <- q1Q %>% add_column(Q2=q2Q$value) %>%  rename(Q1=value)
p1 <- q1QQ %>% na.omit() %>% ggplot(aes(x=Q1,y=Q2)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
q2QQ <- q2Q %>% add_column(Q3=q3Q$value) %>%  rename(Q2=value)
p2 <- q2QQ %>% na.omit() %>% ggplot(aes(x=Q2,y=Q3)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
# q3QQ <- q3Q %>% add_column(Q4=q4Q$value) %>%  rename(Q3=value)
# p3 <- q3QQ %>% na.omit() %>% ggplot(aes(x=Q3,y=Q4)) + geom_point() + geom_smooth(formula = y ~ x,method = "loess")
p <- list(p1,p2)
cowplot::plot_grid(plotlist = p,nrow = 1,ncol = 2)
install.packages(c("backports", "data.table", "feasts", "jsonlite", "loo", "quantmod"))
bookdown::render_book()
knitr::opts_chunk$set(echo = TRUE)
options(knitr.duplicate.label = "allow")
bookdown:::serve_book()
data_wide_tbl
decs
bookdown:::serve_book()
knitr::opts_chunk$set(echo = TRUE)
options(knitr.duplicate.label = "allow")
bookdown:::serve_book()
q_dec_tbl %>% group_by(code) %>%
summarize(n.na = sum(is.na(data)), na.perc = n.na/n()*100)
q_dec_tbl %>% group_by(code) %>%
summarize(n.na = sum(is.na(data)), na.perc = n.na/n()*100)
servr::daemon_list()
servr::daemon_stop(which = servr::daemon_list())
options(knitr.duplicate.label = "allow")
bookdown:::serve_book()
options(knitr.duplicate.label = "allow")
bookdown:::serve_book()
options(knitr.duplicate.label = "allow")
bookdown:::serve_book()
q16262 <- data %>% filter(code=='16262') %>% select(date,data) %>% rename(Q16262 = data) # Gazalkent
data
q16262 <- data %>% filter(code=='16262') %>% select(date,data) %>% rename(Q16262 = data) # Gazalkent
data %>% filter(code=='16262')
knitr::opts_chunk$set(echo = TRUE)
options(knitr.duplicate.label = "allow")
bookdown:::serve_book()
knitr::opts_chunk$set(echo = TRUE)
options(knitr.duplicate.label = "allow")
bookdown:::serve_book()
options(knitr.duplicate.label = "allow")
bookdown:::serve_book()
library(devtools)
library(tidyverse)
library(lubridate)
library(timetk)
install_github("hydrosolutions/riversCentralAsia")
library(riversCentralAsia)
knitr::include_graphics('_bookdown_files/Chap3-ChirchikRB-Figures/ChirchikRiverBasin_Annotated_lr.jpg')
data <- ChirchikRiverBasin
data %>%
filter(type=='Q') %>%
group_by(type,code,station,resolution) %>%
plot_time_series(date,
data,
.facet_ncol      = 2,
.interactive     = FALSE,
.smooth          = FALSE,
.title           = '')
data %>% filter(code=='16262') %>% plot_time_series(date,data,
.interactive = TRUE,
.smooth = FALSE,
.title = "",
.x_lab = 'date',
.y_lab = 'Discharge in cubic meters per second',
.plotly_slider = TRUE)
data %>% filter(code=='16275') %>% plot_time_series(date,data,
.interactive = TRUE,
.smooth = FALSE,
.title = "",
.x_lab = 'date',
.y_lab = 'Discharge in cubic meters per second',
.plotly_slider = TRUE)
q16262 <- data %>% filter(code=='16262') %>% select(date,data) %>% rename(Q16262 = data) # Gazalkent
q16275 <- data %>% filter(code=='16275') %>% select(date,data) %>% rename(Q16275 = data) # Chinaz
q_wide <- left_join(q16262,q16275,by = 'date') %>%
mutate(diffUD = Q16262 - Q16275)
q_wide_annual <- q_wide %>%
summarize_by_time(.date_var = date,
.by="year",
Q16262 = sum(Q16262)*3600*24*10/10^9,
Q16275 = sum(Q16275)*3600*24*10/10^9,
flowDifference = sum(diffUD)*3600*24*10/10^9)
q_long <- q_wide_annual %>% pivot_longer(-date)
p1 <- q_long %>% plot_time_series(date,
value,
.color_var = name,
.interactive = FALSE,
.title = "",
.x_lab = 'date',
.y_lab = 'Discharge in cubic kilometers per year',
.smooth = FALSE)
p1 + theme(legend.position = c(0.1, 0.8))
q16262 <- data %>% filter(code=='16262') %>% select(date,data) %>% rename(Q16262 = data) # Gazalkent
q16275 <- data %>% filter(code=='16275') %>% select(date,data) %>% rename(Q16275 = data) # Chinaz
q_wide <- left_join(q16262,q16275,by = 'date') %>%
mutate(diffUD = Q16262 - Q16275)
q_wide_annual <- q_wide %>%
summarize_by_time(.date_var = date,
.by="year",
Q16262 = sum(Q16262)*3600*24*10/10^9,
Q16275 = sum(Q16275)*3600*24*10/10^9,
flowDifference = sum(diffUD)*3600*24*10/10^9)
q_long <- q_wide_annual %>% pivot_longer(-date)
p1 <- q_long %>% plot_time_series(date,
value,
.color_var = name,
.interactive = FALSE,
.title = "",
.x_lab = 'date',
.y_lab = 'Discharge in cubic kilometers per year',
.smooth = FALSE)
p1 + theme(legend.position = c(0.4, 0.8))
p1 + theme(legend.position = c(0.1, 0.1))
p1 + theme(legend.position = c(0.2, 0.1))
p1 + theme(legend.position = c(0.1, 0.15))
data_stats <- data %>% filter(type == 'Q') %>%
dplyr::select(date,data,code,station) %>% group_by(code) %>%
summarise(mean = mean(data,na.rm=TRUE) %>% round(digits = 1),
min = min(data,na.rm=TRUE) %>% round(digits = 1),
max = max(data,na.rm=TRUE) %>% round(digits = 1),
sd = sd(data,na.rm=TRUE) %>% round(digits = 1),.groups = 'keep')
data_stats %>% select(-code)
# Nice tables - try kable()
#knitr::kable(data_stats, caption = "Key statistics of Chirchik basin rivers.")
data_stats <- data %>% filter(type == 'Q') %>%
dplyr::select(date,data,code,station) %>% group_by(code) %>%
summarise(mean = mean(data,na.rm=TRUE) %>% round(digits = 1),
min = min(data,na.rm=TRUE) %>% round(digits = 1),
max = max(data,na.rm=TRUE) %>% round(digits = 1),
sd = sd(data,na.rm=TRUE) %>% round(digits = 1),.groups = 'keep')
data_stats %>% select(-code)
# Nice tables - try kable()
knitr::kable(data_stats, caption = "Key statistics of Chirchik basin rivers.")
knitr::opts_chunk$set(echo = TRUE)
options(knitr.duplicate.label = "allow")
bookdown:::serve_book()
servr::daemon_list()
servr::daemon_stop(which = servr::daemon_list())
knitr::opts_chunk$set(echo = TRUE)
options(knitr.duplicate.label = "allow")
bookdown:::serve_book()
servr::daemon_list()
servr::daemon_stop(which = servr::daemon_list())
knitr::include_graphics('_bookdown_files/Chap1-Introduction-Figures/geography_CentralAsia')
knitr::include_graphics('_bookdown_files/Chap1-Introduction-Figures/geography_CentralAsia.jpg')
knitr::include_graphics('_bookdown_files/Chap1-Introduction-Figures/WaterResourcesFormation&Use.jpg')
knitr::include_graphics('_bookdown_files/Chap2-HydrologicalSystems-Figures/riversCentralAsiaZoi')
knitr::include_graphics('_bookdown_files/Chap2-HydrologicalSystems-Figures/riversCentralAsiaZoi.jpg')
options(knitr.duplicate.label = "allow")
bookdown:::serve_book()
knitr::opts_chunk$set(echo = TRUE)
options(knitr.duplicate.label = "allow")
bookdown:::serve_book()
![](https://youtu.be/kz_zDRi9Vl8)
knitr::include_graphics('_bookdown_files/Chap1-Introduction-Figures/still_BFC_Construction.jpg')
knitr::include_url("https://youtu.be/kz_zDRi9Vl8")
knitr::include_url("https://youtu.be/kz_zDRi9Vl8")
servr::daemon_list()
servr::daemon_stop(which = servr::daemon_list())
options(knitr.duplicate.label = "allow")
bookdown:::serve_book()
knitr::opts_chunk$set(echo = TRUE)
options(knitr.duplicate.label = "allow")
bookdown:::serve_book()
servr::daemon_list()
servr::daemon_stop(which = servr::daemon_list())
knitr::opts_chunk$set(echo = TRUE)
options(knitr.duplicate.label = "allow")
bookdown:::serve_book()
servr::daemon_list()
servr::daemon_stop(which = servr::daemon_list())
knitr::opts_chunk$set(echo = TRUE)
options(knitr.duplicate.label = "allow")
bookdown:::serve_book()
servr::daemon_list()
servr::daemon_stop(which = servr::daemon_list())
install.packages(c("future", "nlme", "usethis"))
install.packages(c("future", "nlme", "usethis"))
servr::daemon_list()
knitr::include_graphics('_bookdown_files/Preface-Figures/nearSamarkandOasis.jpg')
knitr::include_graphics('_bookdown_files/Preface-Figures/NearSamarkandOasis.jpg')
knitr::include_graphics('_bookdown_files/Preface-Figures/NearSamarkandOasis.jpeg')
knitr::include_graphics('_bookdown_files/Chap1-Introduction-Figures/nearSongKul_lr.jpeg')
knitr::include_graphics('_bookdown_files/Chap1-Introduction-Figures/nearSongKul_lr.jpeg')
knitr::include_graphics('_bookdown_files/Chap2-HydrologicalSystems-Figures/NarynRiver.jpeg')
knitr::include_graphics('_bookdown_files/Chap3-ChirchikRB-Figures/CharvakReservoir_lr.jpeg')
knitr::include_graphics('_bookdown_files/Chap2-HydrologicalSystems-Figures/waterFormationUse.jpg')
knitr::include_graphics('_bookdown_files/Chap2-HydrologicalSystems-Figures/waterFormationUseCentralAsiaZoi.jpg')
knitr::include_graphics('_bookdown_files/Chap2-HydrologicalSystems-Figures/waterFormationUseCentralAsiaZoi.jpg')
knitr::include_graphics('_bookdown_files/Preface-Figures/NearSamarkandOasis.jpeg')
knitr::opts_chunk$set(echo = TRUE)
options(knitr.duplicate.label = "allow")
bookdown:::serve_book()
servr::daemon_list()
servr::daemon_stop(which = servr::daemon_list())
citation()
warnings()
warnings()
library(bookdown)
serve_book()
run servr::daemon_stop(1)
servr::daemon_stop(1)
