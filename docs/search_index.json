[["RSMinerveMODELS.html", "Chapter 4 Hydrological-Hydraulic Modeling", " Chapter 4 Hydrological-Hydraulic Modeling Hydrological-hydraulic models are used for different purposes, including for the design of basin plans while taking into consideration different development options, for the study of effective water resources management schemes while taking into consideration the different types of sectoral users and uses of water in a basin (ideally also including minimal environmental flows), and for the detailed study of basin-scale climate impacts and their repercussions. This Chapter introduces combined hydrologic and hydraulic modeling using the freely available graphical modeling environment RSMinerve (CREALP 2021; Foehn et al. 2020; Garcia Hernandez et al. 2020)1. Figure 4.1 shows a screen shot of a model of the Gunt river basin setup in RSMinerve as a teaser. Figure 4.1: Screenshot of an RSMinerve model setup for Gunt river basin. It should be noted that other modeling packages exist for hydrological-hydraulic modeling. Among others, these include WEAP: Water Evaluation and Planning System, SWAT: Soil &amp; Water Assessment Tool, and Mike Hydro Basin As some if not most of these modeling packages are license-based, the advantage of using the combination of QGIS, R and RSMinerve is that this is a completely free software suit for any user and use scenario. Departing from catchment GIS data, RS Minerve allows to quickly develop, test and calibrate different types of lumped conceptual precipitation runoff models while taking into account the evolution of water balances in glacier, snow, surface and subsurface compartments over time and in different sections in the catchment under consideration. This is demonstrated here for the Gunt River Basin in the Pamirs (see Chapter 2.1 for more information). The main goal in this Chapter is to familiarize the student on how to setup such model, calibrate and validate it for past and current climate conditions and then to study climate change impacts in the basin. The reader is advised to consult the user manual and familiarizes himself or herself with the walk through examples that are discussed and presented there. They give a solid first hands-on introduction about the basic functionalities of the modeling environment.↩︎ "],["section-rsminerve-prerequisites.html", "4.1 Prerequisites", " 4.1 Prerequisites Before delving into this section of the course material, you should have at least: RS Minerve installed How to install RS Minerve. This tutorial was written using RS Minerve 2.9.1.0. Read chapters 1 and 2 from the RS Minerve user manual (Foehn et al. 2020) (the manual can be downloaded from the CREALP website, see Section How to install RS Minerve). Familiarize yourself with RS Minerve by following Example 1 in the RS Minerve user manual. Read the HBV model description in the RS Minerve technical manual (Chapter 2.7) (Garcia Hernandez et al. 2020). You may have to dig deeper into the user manual and the technical manual within the frame of the course but the above points are the minimum requirement to get started. If you fulfill the prerequisites, you should be able to do the tutorial with the minimal description in the modeling section. However, detailed step-by-step descriptions are linked for each task. "],["section-rsminerve-why-model-introduction.html", "4.2 Recap: Hydrological response", " 4.2 Recap: Hydrological response Why do we do hydrological modeling? Typically we want to know how much river flow we can expect at a given time in the future so we can plan our water consumption ahead, harness against floods or implement measures against droughts. So how can we forecast river discharge? For example, one could use the long term seasonal average discharge as the likely future discharge. However, in some years we have high discharge and in some years we have low discharge (Figure 4.2). How to tell when you have which discharge? Figure 4.2: Discharge of the Nauvalisoy river. Let’s go back to the water balance: Where does the water in the river come from? Precipitation. When we compare precipitation and discharge time series we see that the two are related (Figure 4.3). Figure 4.3: Discharge (red) and precipitation (grey) in the Nauvalisoy catchment. Higher precipitation in the catchment is positively correlated with higher discharge in the river with a delay. Or in other words: The discharge is the catchments hydrological response to precipitation. The relationship can be described as follows: \\[ Q \\propto P \\cdot K \\] In words this reads: Discharge (Q) is proportional to precipitation (P) times a transfer function (K) that defines the delay of the signal. The transfer function K describes how precipitation becomes river discharge and depends on the catchment characteristics, importantly on the storage capacity of the catchment. In reality, the transformation of precipitation to discharge is quite complex but we can simplify the reality and come up with a basic conceptual model of our river catchment: a large bath tube with the area of the catchment and an outlet at the bottom called the linear reservoir model (Figure 4.4). Figure 4.4: From the real-life system (left) to a linear reservoir (right). The linear reservoir model describes the discharge from the reservoir as linearly proportional to the storage in the reservoir: \\(Q(t) = 1/k \\cdot S(t)\\) Where Q is discharge, S is the storage and k is a constant called storage coefficient depending on the storage capacity of the reservoir. If k is small, the stored water will run out quickly, if k is large, the stored water will run out slowly. (t) indicate time dependent variables, i.e. variables that change over time. Substitute the linear reservoir equation into the water balance: \\(P = Q + dS/dt \\Leftrightarrow P = Q + k \\cdot dQ/dt\\) Where P is the excess precipitation, i.e. the precipitation that is not intercepted by plants or ponds but contributes to discharge. The above is a differential equation and can be re-arranged: \\((P-Q) \\cdot dt = k \\cdot dQ\\) and integrated and soved for Q(t) (dig out your mathematics!). We assume that at the beginning of our experiment, we don’t have a discharge as the bucket is empty. \\(Q(t) = P(t) \\cdot (1-e^{(-t/k)})\\) This is the equation for the rising discharge curve. Once you turn off the recharge of the reservoir (once you stop pouring water into the bucket), the discharge from the bucket can be described as: \\(Q(t) = Q^* \\cdot e^{-\\tau/k}\\) Which describes the receding limb of the hydrograph (What is a hydrograph) with \\(\\tau\\) being the time since the recharge stopped. Understanding the linear reservoir model is a prerequisite for hydrological modeling. That is why we propose the following exercise for you to do at home as a preparation for class. Task 1: Exerimental setup To understand the flow of water through a reservoir, you will build a bucket model yourself at home from materials that you have at hand and measure recharge as well as discharge from the bucket. You will then make a numerical model of your real bucket model and simulate discharge. Think through the experiment and answer the following questions: What will determine the flow through your bucket? What do you need to measure? How can you measure it? What materials you will need to set up the experiment? Where will you get the water from and can you re-use it after the experiment? Solution to task 1 Task 2: Perform the experiment Set up the experiment and pour water into your improvised reservoir. Take care to pour with a continuous speed over a short time period. You may have to repeat the experiment a few times (see also notes on measurement accuracy in the Solutions of task 1). The outcome of the experiment is a time series of discharge measurements. You can watch a video of the experiment here if you cannot perform the experiment yourself. Task 3: Simulate the experiment The figure below shows the measured discharge from the experimental data shown in the table above. We have implemented a discretized version of a linear reservoir model for you which shows the simulated discharge (grey bars) of a recharge event (blue bars). Play with the storage parameter by moving the slider and see how the simulated discharge changes based on the storage parameter of the simulated catchment. Can you reproduce the measured discharge? If you cannot find a perfect match between measurements and simulation results: What could be the reasons? Solution to task 3 "],["section-hbv-model.html", "4.3 The HBV model", " 4.3 The HBV model The HBV (Hydrologiska Byråns Vattenavdelning) model is a conceptual rainfall-runoff model which is suitable for many snow-fed river catchments (Bergström 1976). You have studied the short description of the "],["data-preparation-and-setup.html", "4.4 Data Preparation and Setup", " 4.4 Data Preparation and Setup The data used in this Chapter can be accessed on the public GitHub repository Applied Modeling of Hydrological Systems in Central Asia and the ./data/AmuDarya/Gunt/ folder in there. It is advisable that the user downloads the data and sets up a similar data directory structure on their local machines. 4.4.1 Examining and Understanding the GIS Data As demonstrated in the Examples of the User Manual, RS Minerve does not necessarily require GIS input files for setting up models. These can also be setup and wired by hand. However, individual subbasins that contribute to flow in a larger catchment have different characteristics that need to be derived from spatial data, i.e. GIS files. For example, subbasin areas, river stretch lengths, terrain slopes, etc., are all required data in an RS Minerve model. These data could either be typed in by hand for each subbasin or automatically inserted via the GIS Import option. The latter method is much more convenient and is demonstrated here2. First, we load the required packages in R. # Loading required packages ## Tidy data wrangling library(tidyverse) library(here) library(timetk) library(tidymodels) library(lubridate) library(timetk) ## riversCentralAsia Package library(&#39;riversCentralAsia&#39;) ## Spatial data processing library(raster) library(sf) Now, we can visualize the GIS files that are required in RS Minerve in the following Figure 4.5. # Load data fPath &lt;- &#39;./data/AmuDarya/Gunt&#39; gunt_DEM &lt;- raster(paste0(fPath,&#39;/GeospatialData/17050_Gund_Basin_DEM.tif&#39;)) gunt_elBands_shp_utm &lt;- st_read(paste0(fPath,&#39;/GeospatialData/Gunt_ElevationBands_Subbasins_RSMinerve.shp&#39;),quiet=TRUE) gunt_subbasins_shp_utm &lt;- st_read(paste0(fPath,&#39;/GeospatialData/Gunt_Subbasins_RSMinerve.shp&#39;),quiet=TRUE) gunt_subbasin_junctions_shp_utm &lt;- st_read(paste0(fPath,&#39;/GeospatialData/Gunt_Junctions_RSMinerve.shp&#39;),quiet=TRUE) gunt_rivers_shp_utm &lt;- st_read(paste0(fPath,&#39;/GeospatialData/Gunt_Rivers_RSMinerve.shp&#39;),quiet=TRUE) # Downsample DEM and create hillshade gunt_DEM_lr &lt;- raster::aggregate(gunt_DEM,fact=10) # this is in UTM 42N gunt_slope &lt;- terrain(gunt_DEM_lr, opt=&#39;slope&#39;) gunt_aspect &lt;- terrain(gunt_DEM_lr, opt=&#39;aspect&#39;) gunt_DEM_hillshade &lt;- hillShade(gunt_slope, gunt_aspect, 40, 270) # Convert to dataframe for ggplotting gunt_DEM_spdf &lt;- as(gunt_DEM_lr, &quot;SpatialPixelsDataFrame&quot;) gunt_DEM_df &lt;- as.data.frame(gunt_DEM_spdf) colnames(gunt_DEM_df) &lt;- c(&quot;value&quot;, &quot;x&quot;, &quot;y&quot;) hillshade_Gunt_spdf &lt;- as(gunt_DEM_hillshade, &quot;SpatialPixelsDataFrame&quot;) hillshade_Gunt_df &lt;- as.data.frame(hillshade_Gunt_spdf) colnames(hillshade_Gunt_df) &lt;- c(&quot;value&quot;, &quot;x&quot;, &quot;y&quot;) # Used for subbasins naming subbasins &lt;- # just put everything in a regular dataframe tibble(basin=c(&quot;Shakhdara&quot;,&quot;Gunt&quot;,&quot;Tokusbulak&quot;,&quot;Alishur&quot;), lat = c(37.4,37.75,37.6,37.65), lon = c(72.0,71.8,72.6,73.25)) subbasins_coord_latlon = SpatialPoints(cbind(subbasins$lon, subbasins$lat), proj4string=CRS(&quot;+proj=longlat&quot;)) subbasins_coord_UTM &lt;- spTransform(subbasins_coord_latlon, CRS(&quot;+init=epsg:32642&quot;)) %&gt;% coordinates() %&gt;% as_tibble() %&gt;% rename(x=coords.x1,y=coords.x2) subbasins &lt;- bind_cols(subbasins,subbasins_coord_UTM) # Plotting ggplot() + geom_tile(data=gunt_DEM_df, aes(x=x, y=y, fill=value), alpha=0.8) + geom_sf(data=gunt_subbasins_shp_utm,color=&quot;black&quot;,fill=NA,linetype=&quot;11&quot;,size=0.25) + geom_sf(data=gunt_rivers_shp_utm,color=&quot;blue&quot;,fill=NA) + geom_sf(data=gunt_elBands_shp_utm,color=&quot;black&quot;,fill=NA,linetype=&quot;11&quot;,size=.2) + geom_sf(data=gunt_subbasin_junctions_shp_utm,color=&quot;red&quot;,fill=&quot;red&quot;) + scale_fill_gradientn(colours = terrain.colors(100)) + xlab(&quot;Longitude&quot;) + ylab(&quot;Latitude&quot;) + guides(fill=guide_legend(title=&quot;Alt. [masl]&quot;)) + ggtitle(&quot;Gunt catchment and subbasins&quot;) + geom_label(data = subbasins,aes(x = x, y = y, label = basin),vjust = 0,hjust = 0) Figure 4.5: Gunt river basin overview, showing the digital elevation model, the 4 subcatchments, the elevation bands with 1’000 meters intervals, the main tributary rivers and the corresponding junctions. Figure 4.5 shows the four subbasins. After the confluence with Tokusbulak river, Alishur river becomes Gunt river in Junction 1 (called junct_1 in the corresponding shapefile below). The confluence is noted by the corresponding red dot. Further downstream, approximately 5 km before the Gunt-Khorog gauging station (Hydromet Code 17050), indicated by the leftmost outlet point (red dot, called junct_2 in the junct_down attribute field of the shapefile), Shakhdara river feeds into Gunt. The subbasin-specific elevation bands are indicated by dotted lines. As described in the RS Minerve User Manual in Chapter 5 (Foehn et al. 2020), the following three shapefiles need to be prepared for later loading into RS Minerve: subbasins.shp, junctions.shp and rivers.shp (see Figure 4.6). Figure 4.6: Required GIS input files for RS Minerve. See corresponding user manual for more information. The shapefile attributes that you downloaded of the required data can easily be displayed. First, we analyze the subbasins `gunt_elBands_shp_utm` file. The file contains the following attributes as per the requirements specified in Figure 4.6: name and junct_down. The attributes Z, ModelGuid and geometry are additional fields. The field Z that contains information of the mean elevation of the subbasin. Note that the shapefile is does not only contain the shape of the four subbasins Alishu, Tokusbulak, Gunt and Shakdara but also the elevation bands of each subbasin. # view meta data summary of the subbasins file gunt_elBands_shp_utm &lt;- sf::st_read(paste0(fPath,&#39;/GeospatialData/Gunt_ElevationBands_Subbasins_RSMinerve.shp&#39;),quiet=TRUE) gunt_elBands_shp_utm ## Simple feature collection with 14 features and 3 fields ## geometry type: MULTIPOLYGON ## dimension: XY ## bbox: xmin: 725348.3 ymin: 4093789 xmax: 945535.6 ymax: 4216482 ## projected CRS: WGS 84 / UTM zone 42N ## First 10 features: ## name junct_down Z geometry ## 1 basin_l1_b2 junct_1 3764.159 MULTIPOLYGON (((796644.2 41... ## 2 basin_l1_b3 junct_1 4503.951 MULTIPOLYGON (((827142.4 41... ## 3 basin_l1_b4 junct_1 5218.727 MULTIPOLYGON (((827592.4 41... ## 4 basin_m1_b2 junct_1 3764.159 MULTIPOLYGON (((801343.9 41... ## 5 basin_m1_b3 junct_1 4503.951 MULTIPOLYGON (((838641.8 41... ## 6 basin_m1_b4 junct_1 5218.727 MULTIPOLYGON (((840091.7 41... ## 7 basin_l2_b1 junct_2 2765.624 MULTIPOLYGON (((727648.2 41... ## 8 basin_l2_b2 junct_2 3764.159 MULTIPOLYGON (((726448.3 41... ## 9 basin_l2_b3 junct_2 4503.951 MULTIPOLYGON (((757446.5 40... ## 10 basin_l2_b4 junct_2 5218.727 MULTIPOLYGON (((760396.3 40... This is because in RS Minerve, we will model each elevation zone of each subbasin with a separate rainfall-runoff model. These are then linked to each other via the topological ordering that is given by the rivers and junctions. The naming of the subbasins is somewhat arbitrary and tailored to the particular catchment under consideration. The prefix ‘basin_’ is everywhere the same. The basic idea is to identify a main river stem (denoted with mX) where the X is a number that increases from 1 towards the downstream after each confluence with a right or left tributary. In our case, Alishur river is denoted with m1. Gunt river, which emerges after the confluence with Tokusbulak (see Figure 4.5), is denoted with m2. Finally, Gunt river after the confluence with Shakhdara is m3. Each left tributary is denoted with lX and each right tributary with rX, where X is again a number starting from 1 and gradually increasing. In our case, Tokusbulak thus is l1 (the first left tributary joining the main river). Finally, Shakhdara is l2. Note, in the Gunt river basin, we do not have major right tributaries. ‘m1_b2’ the refers to the main upstream river, Alishur in this case, and its elevation band 2. m1_b3 would then be the third elevation band accordingly and so on. Why is there no m1_b1 feature? This is simple to understand. Since the entire basin is subdivided into n equally spaced elevation zones, the higher lying subbasins might no longer contain all elevation bands. For both, Alishur (main m1) and Tokusbulak (l1) this is the case where band b1 is simply not represented because of the high elevations of the subbasins. # view meta data summary of the junctions file gunt_subbasin_junctions_shp_utm &lt;- sf::st_read(paste0(fPath,&#39;/GeospatialData/Gunt_Junctions_RSMinerve.shp&#39;),quiet=TRUE) gunt_subbasin_junctions_shp_utm ## Simple feature collection with 3 features and 2 fields ## geometry type: POINT ## dimension: XYZM ## bbox: xmin: 724198.4 ymin: 4151736 xmax: 795694.3 ymax: 4178534 ## z_range: zmin: 2074.126 zmax: 3118.366 ## m_range: mmin: 0 mmax: 0 ## projected CRS: WGS 84 / UTM zone 42N ## name river_down geometry ## 1 junct_2 gunt_ds POINT ZM (728998.1 4151736 ... ## 2 junct_3 &lt;NA&gt; POINT ZM (724198.4 4152236 ... ## 3 junct_1 gunt_us POINT ZM (795694.3 4178534 ... For the junctions shapefile, we define their names as well the field river_down, i.e. the name of the river downstream of the junction. Finally, for the rivers shapefile, we define the rivers name and the downstream junction junct_down. The terminal junction corresponds to the outlet of the model. It can be easily seen that junct_3 is the outlet since there is no more downstream river, i.e. &lt;NA&gt;. # view meta data summary of the rivers file gunt_rivers_shp_utm &lt;- st_read(paste0(fPath,&#39;/GeospatialData/Gunt_Rivers_RSMinerve.shp&#39;),quiet=TRUE) gunt_rivers_shp_utm ## Simple feature collection with 5 features and 3 fields ## geometry type: LINESTRING ## dimension: XYZM ## bbox: xmin: 724198.4 ymin: 4119538 xmax: 923686.9 ymax: 4196533 ## z_range: zmin: 2074.126 zmax: 4040.01 ## m_range: mmin: -1.797693e+308 mmax: 0 ## projected CRS: WGS 84 / UTM zone 42N ## name junct_down LENGTH geometry ## 1 shakhdara junct_2 112475.030 LINESTRING ZM (801893.9 414... ## 2 gunt_ds junct_3 5338.169 LINESTRING ZM (728998.1 415... ## 3 tokusbulak junct_1 49114.525 LINESTRING ZM (829392.3 415... ## 4 alishur junct_1 179844.135 LINESTRING ZM (923686.9 418... ## 5 gunt_us junct_2 15945.881 LINESTRING ZM (795694.3 417... 4.4.2 Loading GIS Data and Model Creation As described in the RSMinerve user manual in Chapter 5 there, these three shapefiles can then be loaded into RSMinerve and automatically translated into an RSMinerve model via the Creation option (Foehn et al. 2020). In Figure 4.7, a screen shot is shown where in a somewhat arbitrary manner, all subbasins got assigned individual HBV models. Note the highlighted Creation button. Figure 4.7: Using the Creation Menu, the information from the shapefiles gets translated into a number of interlinked subcatchment and elevation band-specific models. Since the shapefile containing the elevation bands for each subbasin also contains mean subbasin elevation, we can extract the Altitude (Z) from the corresponding feature. Similarly, the area of the subbasins and the length of the rivers can all be computed from the shapefiles. The corresponding boxes should be ticked. After these steps, the student can click the Create Model button in the lower left corner of the window and then switch to the Model New tab to examine the resulting model. A screen shot showing the results is shown in Figure 4.8. Figure 4.8: The result of the GIS-based creation of the Gunt river basin model in RSMinerve. Note that even without proper arrangement of the individual model elements, the subbasins and their models are already visible. After rearranging the individual model elements and loading a background .jpeg-image (see Figure 4.1, the setup step has been completed. 4.4.3 Climate Data RSMinerve simulates discharge in response to climate forcing. We assume that the basic steps of GIS basin delineation have been carried out as described in Chapter ?? and the Section ?? there. We thus depart here assuming that the basin outlet (i.e. the location of the discharge gauge), the basin shape file as well as the digital elevation model are available.↩︎ "],["model-calibration-and-validation-1.html", "4.5 Model Calibration and Validation", " 4.5 Model Calibration and Validation Some random text to test 4.5.1 Basic Principles 4.5.2 Practical Steps "],["application-investigating-climate-change-impacts.html", "4.6 Application: Investigating Climate Change Impacts", " 4.6 Application: Investigating Climate Change Impacts "],["discussion.html", "4.7 Discussion", " 4.7 Discussion "]]
