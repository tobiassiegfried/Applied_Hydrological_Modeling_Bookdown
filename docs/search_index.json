[["index.html", "Applied Modeling of Hydrological Systems in Central Asia Welcome", " Applied Modeling of Hydrological Systems in Central Asia Tobias Siegfried 2020-11-06 Welcome Welcome to the online course book on Central Asian hydrology and the mathematical modeling of the hydrological systems there. The book is dedicated to the young and aspiring water professionals of the region. The book adopts an open-source philosophy and promotes the use of open-source data and software. The online version is hosted at https://tobiassiegfried.github.io/Applied_Hydrological_Modeling_Bookdown/, maintained via GitHub and currently work in progress. "],["01_Preface.html", "Preface", " Preface This handbook is geared towards young water professionals in Central Asia. It consists of two main parts. Part I presents the hydrological systems of the region. This part fuses a selective synthesis Victor Shults’ famous Russian book “Rivers of Middle Asia,” published as second edition in 1965 with modern insights and knowledge from recent research (Shults 1965). I hope that this combination provides an attractive, approachable and yet scientifically sound introduction to the many interesting hydrological features of this diverse region. Part II provides a learning manual to equip students with a hands-on guide on how to conceptualize, implement, calibrate, run and validate hydrological models. Physically-based and empirical models are both introduced and discussed. The philosophy of working by example is followed and all concepts and modeling approaches are discussed in the context of the sample catchment of the Chirchik River whose tributaries are shared by Uzbekistan and Kyrgyzstan. The emphasis is strictly on the use of open-source software. The author is grateful for the support by the Global Water Programme at the Swiss Agency for Development and Cooperation and especially to Stephanie Piers de Raveschroot and Andre Wehrli there. The author owes a lot to Andrey Yakovlev who provided invaluable guidance throughout his professional career. Tobias Siegfried Zurich, June 2020 "],["02_Foreword.html", "Foreword", " Foreword The conquest of nature, as per the thinking of the Russian government in the late 19th century, was an essential precondition of successful colonial policy. It enabled the economic appropriation of new territories and facilitated the development of administration and the integration of local authorities into the colonial system (Pravilova 2009). There is a profound riddle at the core of everything the engineer does in Central Asia (one might even want to call it the great paradox). Namely, Soviet planning organized space and resources so that the units under consideration (including human resources) could be “identified, observed, recorded, counted, aggregated and monitored” (C. Scott: Seeing like a State, Part 3: The Social Engineering of Rural Settlement and Production). All engineering in Central Asia was based on this, be it for irrigation projects, railway lines and hydropower dams that have become emblems of authoritarianism in Soviet Central Asia (Jonas van der Straeten: Borderlands of Industrial Modernity: Explorations into the History of Technology in Central Asia, 1850 - 2000). Should there thus not be an innate interest “built-in” to the Central Asia Water Stakeholders that takes its legacy from this organizational heritage and thus jump on any new technology that would help them to improve their planning skills, also e.g. in an objective way through the use of space-based information? What emerged over time was a “coexistence of the infrastructural and industrial legacies of its Soviet period, artisanal practices and material cultures (like the water management in canals that you mention and that resembled in many ways what is still practiced today in Wallis) that date back to the pre-Soviet time, and by the changes brought by the rapidly accelerating circulation of goods, tastes, and ideas in post-Soviet years. The coexistence of these different influences, however, is not always a harmonic one. It constantly leads to in-between situations, tensions, and paradoxes.” (Jonas van der Straten:…). Tsarist and Soviet occupation and colonialism, a great disrupting force of a fragmented place with historically highly fragmented administrative structures between the traditional oases that were regarded as backward and characterized as “medieval barbarity” by those very occupiers? Occupiers, that is, that, at least in private, often acknowledged that European irrigation technology was inferior to indigenous traditional methods? Some US Engineers were called in early on by the Soviets to help in the large scale landscape transformation as described in Teichmann in Chapter 7 and also for the introduction of the ‘American’ long-staple cotton varieties. It is instructive to quote one of them as Teichmann did: »In den Büros, auf Konferenzen und in der Presse geht es immer nur um Pläne, Programme und Fristen«, berichtete der amerikanische Ingenieur Willard Gorton nach seiner Rückkehr aus der Sowjetunion in die Vereinigten Staaten 1933. »Es wäre eine Art kommunistisches Sakrileg, etwas zu unternehmen, ohne vorher einen Plan, oder besser: ein halbes Dutzend Pläne, gemacht zu haben.« Gorton hatte zwei Jahre lang als Bewässerungsingenieur in Taschkent gearbeitet und wusste, wovon er sprach. Sowjetische Pläne und sowjetische Wirklichkeit standen, wie er immer wieder feststellen musste, in einem unauflösbaren Widerspruch. Die Planwirtschaft behindere das Erreichen der vorgesehenen Planziele, statt es sicherzustellen. »Das tatsächliche Ergebnis der Pläne«, meinte der Ingenieur, seien »Chaos« und »Unordnung«. »Vergleicht man die Leistungen, die die Roten von Tag zu Tag vollbringen, mit den Möglichkeiten, die sie von Tag zu Tag verschenken, scheint es, dass sie auf ganzer Linie scheitern werden.«1 Die Schwachpunkte der Planwirtschaft hatte Gorton schnell erfasst: Die sowjetischen Pläne beruhten auf »illusorischen Hoffnungen« und die Planer »verplemperten« ihre Zeit mit dem »Verfassen von Märchen«. Und immer gebe es mehrere, einander widersprechende Planszenarien, von denen keines ausgereift genug sei, um umgesetzt werden zu können. Obwohl »alles bis zum letzten Atemzug« durchgeplant sei, herrschten bei der Arbeit »Durcheinander, Unsicherheit und Verantwortungslosigkeit« und die Pläne erzeugten eine »kontinuierliche und überall verbreitete Unordnung, die an Chaos grenzt«. Das sowjetische Alltagsleben sei von »all den Ärgernissen und Unsicherheiten« geprägt, »die man in den kapitalistischen Ländern finden kann, und vielen anderen mehr, die man hier nicht finden kann«. Zudem erzeuge der verschwenderische Umgang mit Ressourcen Mangel und Not. »Du planst und arbeitetest und verhungerst dabei«, berichtete Gorton. Wenn man überhaupt davon sprechen könne, dass die Sowjetunion »nach einem Plan lebe«, sei dieser »sicherlich vom Teufel selbst erdacht«. Identification, observation, recording, counting, aggregating, and monitoring (all that also we have been talking about in Tashkent during our exchange) - all based on “dem Verfassen von Märchen” in Soviet Times? And, might it truly have been so that the centralized command and control economy was in reality directed “according to a system of preferences and not according to precise scientific planning” (Robert Davies quoted in Teichmann)? I believe that the Czarist invaders were driven by scientifically ‘enlightened’ engineering. The same applied to the Homo Sovieticus who now extended engineering also in the social practices. Yet, despite its overwhelming power and oversight, the empire was never able to control every aspect of life of the indigenous people. Was it maybe that this enlightened science had to adapt over time, adapt in the sense as described above, to comply to Stalin’s Planvorgaben and so became to rely on fairy tales? Additionally, was it that the ‘Western’ technology and science got adapted to the local colonized conditions and became a complex process of negotiation, contestation, cooptation, and resistance at work\" (Cited from Baber in Obertreichs Book)? "],["03_PI_Introduction.html", "Chapter 1 Introduction 1.1 The Geography of Central Asia 1.2 The Taming of Natural Hydrological Regimes for Irrigation 1.3 Post-Transition Development and Challenges", " Chapter 1 Introduction 1.1 The Geography of Central Asia 1.2 The Taming of Natural Hydrological Regimes for Irrigation 1.3 Post-Transition Development and Challenges "],["04_Hydrological_Systems.html", "Chapter 2 Hydrological Systems in Central Asia 2.1 Regional Hydro-Climatological Features 2.2 Regional Water Balance 2.3 Runoff Formation 2.4 Average Multi-Year Runoff 2.5 Annual Runoff Fluctuations", " Chapter 2 Hydrological Systems in Central Asia 2.1 Regional Hydro-Climatological Features The inhomogeneity of the relief structure causes Central Asia to be the territory of immense contrasts. Here, extreme aridity in the hot deserts of the plains and, only 100 km away, abundant humidity and snowfields in the mountains where precipitation levels can range between 1’000 mm up to 2’000 mm. The uneven distribution of water bodies is striking. The mountains of Central Asia are riddled with an extremely branched river network consisting of more than ten thousand watercourses. In the flat foothill areas surrounding the mountain ranges, another branching river network is found which consists of irrigation channels, which do not contribute to the runoff of the core rivers, but rather divert the water from the river network and diffuse it in the irrigated oases where much of it gets evapotranspirated. Central Asia is spreading over approximately 4 million km2, including the territories of Kazakhstan, Kyrgyzstan, Tajikistan, Turkmenistan and Uzbekistan (Central Intelligence Agency, n.d.). In the vast plains that cover around 70% of the total territory, there are only very few rivers which have scarcely any tributaries from the point they leave the mountain areas all the way to their mouth. Abundant solar radiation, high temperatures, small amounts of precipitation, a lack of humidity, unstable snow cover, slight slopes, geological structures1, etc., hinder the formation of surface flows in the plains of Central Asia, despite their big importance for the local agricultural production there. Only the largest rivers, such as Syr Darya, Amu Darya, and Ili are able to survive hundreds of kilometers of deserts and reach the most important landlocked reservoirs – the Aral Sea and Lake Balkhash (Shults 1965). Figure 2.1 shows an overview of the region. Figure 2.1: Map highlighting the Central Asian rivers network (rivers are shown in blue color). The dense river network in the mountainous areas starkly contrasts with the one in the plains. The main irrigation canals are shown in orange color. GIS Data from https://tools.geofabrik.de/osmi/. All Central Asian river basins are endorheic with no water draining out of the region but only evaporating back to the atmosphere. This emphasizes the importance of moisture transfer as an important mechanism in the region region since the formation of substantial watercourses in the mountains is followed by their complete dissipation in the plains, including in the irrigated oases and the terminal lakes, i.e. the Aral Sea and Lake Balkash. In the boreal summer, tropical air masses form in the plains of Central Asia. At that time, even cold air masses coming from the north heat quickly. There is no possibility for temperature differences between the lower and the middle troposphere to occur which explains the horizontal uniformity of high temperatures during summer. Contrary to this, the temperature differences in the region are highest in January during the peak of the boreal winter. As the territory of Central Asia is unprotected from the north, it is under the influence of dry, exceptionally cold air masses originating from the Arctic region and Siberia. These air masses can cause sharp frosts. The further the Siberian or Arctic air masses penetrate towards the west and the south, the more their temperature increase. This explains the big difference in air temperatures during winter between the north and the south of Central Asia. Cold air intrusions are often accompanied by the influx of warm air from the tropics. The cold waves taking turns with hot air masses cause unsteady frost in the plains and, together with generally low precipitation values, do not allow for the formation of a significant snow pack there (Shults 1965). //TODO: properly reference Section here. As is discussed further below, the winter snow cover in the high mountain ranges plays an essential role in runoff formation in the spring and summer months and is thus of key relevant to irrigation agriculture in the downstream and for hydropower production (see Section~ below). Understanding the atmospheric mechanisms resulting in favorable conditions for winter precipitation is thus essential. With a warming climate and the associated increase of evapotranspiration in the downstream plains and the loss of glacier storage in the mountainous areas, a solid understanding of snow pack formation becomes even more pertinent. (Gerlitz et al. 2018) discusses how the position of the westerly jet stream is connected with the frontal trajectories and the westerly disturbances which are the main moisture sources if the region. The relative position of these planetary wave tracks and their associated westerly flows to the orographic mountain barriers plays thus a key role. The main precipitation events migrate over the winter season from south to north. The southern parts of central Asia, particularly the windward slopes of the Karakorum and Hindu Kush mountain ranges, receive high amounts of winter precipitation (December-January-February), which reaches up to 60% of the total annual precipitation. During spring the zone of maximum precipitation migrates northward, reaches the Pamir plateau in March, and continues to Tien Shan in April/May. The interaction of tropical air masses from the Arabian Golf with westerly flow in Central Asia is another important moisture source for the region. Using data of the ERA-Interim reanalysis, (Gerlitz et al. 2018) classifies 8 weather types (WT) based on typical regional pressure field patterns over a domain covering 20- 60N and 50- 90E. Like this, large-scale features of winter circulation patterns in Central Asia can be captured. WT are analyzed with regard to the spatial anomalies of temperature and precipitation. Figures 2.2 and 2.3 show results. In these Figures, the individual plates WT 1 - 8 are labeled according to the main circulation feature over Central Asia, i.e. a Rossby ridge (R) or trough (T). Generally, it can be observed that configurations that are associated with a Rossby trough over Central Asia lead to an intensification of westerly moisture fluxes (WT 3, WT 7, and WT 8). If there is, however, a Rossby ridge type configuration as shown in WT 1, WT 2, and WT 4 panels of Figures 2.2 and 2.3, moisture fluxes are northward-shifted and precipitation suppressed (Gerlitz et al. 2018). Figure 2.2: Composite maps illustrating the averaged anomalies of ERA-Interim/Land 6-hourly temperature for each weather type (WT 1 - WT 8). Values are depicted in standard deviations for each grid cell, respectively. Arrows indicate anomalies of the 500-hPa ERA-Interim wind field (Gerlitz et al. 2018). Figure 2.3: Composite maps illustrating the averaged anomalies of ERA-Interim/Land 6-hourly precipitation sums for each weather type. Values are depicted relative to the seasonal mean 6-hourly precipitation sum ((100)-1) for each grid cell, respectively. Arrows indicate anomalies of vertically integrated moisture fluxes (Gerlitz et al. 2018). Precipitation is extremely unevenly distributed in the region. 20% of the plain area receives less than 100 mm, while 91% of the territory receives less than 300 mm of precipitation a year with an overall average of 173 mm. The mountains are thus an important climatological and hydrological factor, since they are the places where the water condensates and where the rivers and groundwater originate. Although the range of precipitation levels is wide (60 mm - 2’500 mm), the mountains receive on average more than three times more precipitation than the plains, and the low temperatures favor its accumulation in the solid state (Shults 1965). The influence of the relief is notable also when speaking of precipitation distribution during the year. The high ground areas in Central Asia are witnessing an almost even distribution of precipitation on monthly basis, whereas at the same time, in the inner parts of high mountain ridges there is more precipitation in summer. Such a distribution of precipitation in the inner parts of mountain ridges is a consequence of high condensation levels in summer due to intense evaporation taking place in snow melting areas or, less often, on water surfaces. A typical example showing the influence of the local water vapor emission on annual distribution of precipitation could be the Issyk Kul Lake Basin. There the percentage of precipitation received during summer and the second half of spring, so from May to August, is sometimes reaching even 80% of the total annual precipitation amount, all thanks to the evaporation of the water from the lake and the emergence of thermal convection and subsequent moisture recycling. The areas that are characterized by a predominant precipitation during summertime are the Central Tian Shan and Eastern Pamir, where the difference between the summer and the rest of the year is so big that during summer 60% of all annual precipitation is received. The predominance of the precipitation during summer in case of mountains with steep slopes (15° - 30°) causes fast and abundant snowmelt runoff which is directed to the lower areas and then turns into a river network. Thanks to a large amount of precipitation, relatively low evaporation levels and steep slopes, all rivers of Central Asia, including the largest ones such as Amu Daria, Syr Daria, Ili or Zeravshan, arise in the mountains. Arising in the high ground area, these rivers are mainly fed by snow, glaciers and snow patches melting, as well as by groundwater that, again, were all formed by the same sources. Due to the presence of the vertical thermal gradient, the start of the positive air temperature season, and consequently, the start of the ice and snow melting season does not take place at the same time uniformly. Rather, the snow melting process is of protracted nature and the higher the mountains are in a particular catchment, the later the snow-melt floods take place on rivers that are emerging there. The melting process starts last in the permanent snow and glaciers regions. Because of this, the rivers, which are fed by snowmelt in the upper parts of the catchment area, are of great importance for the irrigation of crop fields, since they are characterized by the most significant water runoff during July and August, at which point the irrigated plains experience severe drought and when irrigated crops have the highest water demand. The rivers having this kind of a runoff regime (nivo-glacial) are Pyandzh and Vakhsh Rivers, as well as the ones deriving from them, such as Amu Darya, Chu, Zeravshan, Talas and Ili Rivers with its numerous tributaries. These rivers all feature a small variability of annual runoff. This is partly a result of the regulating effect of the zone of eternal snows and ice and is very important from the perspective of agricultural production in the downstream. These rivers are thus particularly valuable, not only for irrigation but also as a source of hydroelectric power. Rivers originating from the low mountains but being fed mainly by the snowmelt (nival regime rivers), are characterized by the early floods (March-May) and a sharp variability of annual runoff, since the amount of water is almost entirely determined by the snow reserves in the mountains which were accumulated in the previous winter season. Finally, the watercourses originating from the lowest parts of mountains or from low mountains, (nivo-pluvial regime rivers), which in comparison to other regimes receive much more liquid precipitation, are characterized by large amounts of water, often saturated by sediment, passing during short periods of time. These are so-called mudflows. These watercourses often dry up during summer because of a decrease in supplies from groundwater. When entering the plains, the rivers of Central Asia form wide-spreading alluvial fans consisting of materials brought by them from the mountains. Here the rivers are usually divided into several channels, and a large part of water is filtered by these sediments. The large quantities of groundwater in these alluvial fans, which appear due to this process, mostly protrude from the earth surface at the edges these alluvial fans, causing the small rivers that are fed by groundwater, so-called Karasu rivers, to emerge, which are also used for irrigation. The relief thus has an extremely strong and many-sided impact on runoff formation processes. This influence is mediated through climatic factors, on which the recharge of the rivers, as well as the processes of thawing of snow and ice, etc., depend. In this regard, both the average water content, consistency of the annual runoff and its distribution over a year, as well as other characteristics of the river runoff cannot be considered independently from key relief factors, first and foremost altitude. All this demands a careful and comprehensive analysis of the impact of the relief on runoff processes. 2.2 Regional Water Balance It is instructive to show the opposite hydrological functions of mountain versus flat areas of Central Asia by means of simple water balance considerations. The water balance equation for mountain area, broadly defined, can be written as follows: \\[\\begin{equation} \\tag{2.1} p = e + q_{s} + q_{g} \\end{equation}\\] whereby \\(p\\) represents the average long-term amount of precipitation and condensation of water vapor from the atmosphere, \\(e\\) the average long-term evaporation, \\(q_{s}\\) the average long-term surface outflow and \\(q_{g}\\) the average outflow of groundwater. This equation shows that the mountain area receives moisture only from the atmosphere and rainfall which precipitates within its limits and evaporates only partially. The remainder part of it flows down in the form of surface and underground drainage. Sharp partition of a relief in the mountain area, and consequently, a deep natural drainage is the reason why groundwater is almost entirely connected to the river network already in the mountain area. The Meso-Cenozoic deposits, containing waterproof horizons, and the Paleozoic massifs on the border with the flat areas obstruct groundwater flows. Thus, the groundwater inflow to the flat areas makes no more than 10% - 15% of the surface one and therefore it can be neglected in the first equation. Then the water balance equation will have the following appearance: \\[\\begin{equation} \\tag{2.2} p = e + q_{s} \\end{equation}\\] Based on available data, the rate of surface outflow \\(q_{s}\\) can be calculated quite precisely: 155 billion m3 or 201 mm annually. River basin-specific surface runoff values are provided in Table. It is impossible to measure the amount of the accumulated water vapor in the mountains accurately just by observation, so we have to proceed from the rate of the runoff, for which we need to know the value of runoff coefficient. The last can be approximately considered as equal to 0.35 (see also next Section). Then, \\(p\\) equals 575 mm and \\(e\\), as follows, 575 mm - 201 mm = 374 mm. Table 2.1: Key water balance basin statistics of selected large basins in Central Asia. Basin Name Area (km2) Runoff (m3/s) Runoff entering flatlands (m3/s) Runoff Coeff. (l/ (s km2)) Caspian Sea 29’700 22 12 0.74 Endhoreic Basins of TUK and AFG 193’300 180 155 0.93 Amu Darya 227’300 2’500 2’500 11 Syr Darya 150’100 1’200 1’200 8 Chu and Talas River Basin 37’540 190 190 5.1 Lake Issyk Kul 12’600 115 - 9.1 Southern Balkash Lake 119’000 800 800 6.7 Total 769’600 5’007 4’857 6.5 It should be noted that the rate of surface water inflow to the flatlands is smaller than the runoff which is generated in the mountain areas as part of it is utilized in the mountain area for irrigation purposes (the rivers of Turkmenistan are in this regard an especially good example), or it evaporates from a surface like of the Lake Issyk Kul and other smaller lakes. If, from the mountain area, we exclude reservoirs of the river Atrek and the rivers of Turkmenistan and Afghanistan with no runoff which, occupying the big space (29% of all mountain area of Central Asia), excel in a minute quantity of rainfall and exclusively low water levels, separate elements of water balance will be expressed by the following sizes: \\(p\\) = 675 mm , \\(q_{s}\\) = 270 mm and \\(e\\) = 405 mm. In this case, the water balance of mountain area shows its hydrological essence even more clearly. The equation of water balance for the flat area can be written in the form of \\[ p + q_{i} = e \\] where \\(q_{i}\\) represents the surface inflow of water. We neglect underground outflow in the flat area as, even when it takes place, it is absolutely insignificant. The average amount of rainfall calculated by planimetering of the isohyetal map is equal to 173 mm. The rate of inflow of water is equal to the outflow of water from mountain area, i. e. \\(q_{s} = q_{i} = 155 \\cdot 10^{9} \\text{ m} ^{3}\\). After making its way down to the flat area, which includes the surface of the Aral Sea and Lake Balkhash, the surface inflow of the rivers reaches 124 mm and the evaporation is \\(e = p + q_{i} = 173 \\text{ mm} + 124 \\text{ mm} = 297 \\text{ mm}\\). It is noteworthy to mention that from the entire moisture appearing in the flat area, 58% nevertheless is from atmospheric precipitation, despite its rather insignificant absolute amount. Comparing the two water balance equations shows that the mountain areas receive 575 mm of moisture from the atmosphere of which 374 mm evaporates back to the atmosphere and 201 mm reach the downstream flat area in the form of a surface runoff. Conversely to this, the flat areas receive 297 mm of water from direct precipitation and from inflow of mountain runoff. All of this water evaporates back to the atmosphere. To summarize, it is clear that in the area of runoff formation, \\(p&gt;e\\), in the area of runoff losses \\(p&lt;e\\), and that in the area of runoff balance \\(p\\approx e\\). In each area where the runoff processes show the same orientation, its origin, distribution in time and space, and also the intensity of processes can however vary. In this sense, depending mainly on local topography (generally speaking, depending on the altitude, orientation and exposure of a reservoir to humid air masses), the specific runoff, the persistence of the annual runoff and its distribution over a year, as well as other characteristics of the river flow can sharply differ in different parts of the area of runoff formation, as it was already discussed above. On the other hand, the intensity of runoff losses, their distribution over a year, etc. within the area of runoff losses, considerably depend on the economic activities and features of climatic conditions. 2.3 Runoff Formation The process of runoff formation is critically determined by the generation of direct runoff from liquid precipitation and the melting of snow and ice over the course of a hydrological year. Considering carefully the individual components for basins under consideration is important in order to properly understand the runoff regimes of individual rivers and for conceptualizing key processes for mathematical modeling. Figure 2.4: Map of the upper Syr Darya and Amu Darya catchments. The catchments are outlined. Colors encode topographic height. Basin outlets (red dots) are chosen to correspond to the confluence of the two main rivers for each catchment. Topographic data is from (“Srtmgl1 n -ASA SRTM Version 3.0” 2020). First, we study the role of glacier melt. For this, it is instructive to start to look at the condition of discharge formation in the Amu Darya and Syr Darya basins (see Figure 2.4). More specifically, we compare the two main subcatchments of the Vakhsh and Pyandzh Rivers in the Amu Darya and the Naryn and Kara Darya catchments in the Syr Darya^2. In the first two reservoirs, the mountains exceeding 5’000 m occupy 6.2% of their area, and the mountains higher than 4’000 m — 42%, in case of reservoirs of the second two rivers, the mountains exceeding 5’000 m occupy less than 1% of their area and the ones with altitudes over 4’000 m — only 4%. Figure 2.5 shows the basins’ hypsographic curves. Even if we take into account that in the case of the basins of Pyandzh and Vakhsh the snow line is on average located at the height of 4’600 m — 4’500 m and in case of the basins of Naryn and Kara Darya at 4’000 m - 3’900 m, 19% — 22% of the reservoirs of Pyandzh and Vakhsh is located above the snow line, and in case of reservoirs of Naryn and Kara Darya it is only 4% — 5%. The role of glaciers in the annual distribution of runoff is thus more substantial in the case of the Amu Darya as compared to the Syr Darya. And to come to an informed conclusion, one has to take into account all land ice features, including their altitude. Figure 2.5: Hypsographic curves of the upper Syr Darya and Amu Darya catchments. The SRTM topographic model was used for the calculation of the curves (“Srtmgl1 n -ASA SRTM Version 3.0” 2020). Data on land ice can be obtained from the Global Land Ice Measurements from Space glacier database GLIMS (GLIMS and NSIDC 2005, updated 2018). The Global Land Ice Measurements from Space (GLIMS) project at NSIDC has implemented a database of glacier outlines from around the world and other information about glaciers that includes the metadata on how those outlines were derived. At &lt;www.glims.org&gt;, one can download outlines and metadata for glaciers in a choice of different formats, including KML (for viewing in Google Earth), ESRI shapefiles, GMT (Generic Mapping Tools), MapInfo, or GML (Geography Markup Language). Figure 2.6 shows a sample visualization of the GLIMS data for the zone of runoff formation of the Amu Darya. The data will also be utilized in Chapter (ref?)(#HydrologicalSystems) below to obtain good ideas of the subcatchments’ glaciation levels. Figure 2.6: Visualization of the GLIMS data glaciation in the Vaksh-Pyandzh basin. The light blue shaded polygons show land ice on top of the underlying digital elevation model. Figure 2.7 shows the distribution of mean glacier elevations of the Randolph Glacier Inventory 6.0 dataset in the GLIMS database. The center of mass for the Amu Darya is at 4’827 masl whereas it is at 4’110 masl for the Syr Darya. Figure 2.7: Distribution of mean glacier elevations as extract from the GLIMS database. Only data from the Randolph Glacier Inventory 6.0 was used as subset of the complete GLIMS record. For the computation of the mean elevation, SRTM data was utilized. Since the GLIMS database contains contains the shapes of glaciers as geometric features, we can calculate easily calculate areas that the individual glaciers cover and then utilize scaling relationships between surface area and volume to estimate total ice storage in the individual Central Asian catchments. (Aizen, Aizen, and Kuzmichonok 2007) reports such scaling relationship for the Central Asian region. As a function of glacier area, they are \\[ V = 0.03782 S^{1.23} \\text{ for } S&lt; 0.1 \\text{ km}^2 \\\\ V = \\frac{0.03332 S ^ {1.08} e^{0.1219 L}}{L^{0.08846}} \\text{ for } 0.1 &lt; S &lt; 25 \\text{ km}^2 \\\\ V = 0.01848 S + 0.021875 S^{1.3521} \\text{ for } S &gt; 25 \\text{ km}^2 \\] where \\(S\\) is the area of a glacier, \\(L\\) the length of the glacier and \\(V\\) the computed volume from the scaling relationship. The length \\(L\\) of the individual glaciers can be approximated by subtracting the minimum glacier elevation from the corresponding maximum elevation. Like this, we can compute land ice volumes of the Amu Darya and Syr Darya basins in an approximate yet scientific way. Alternatively, we can use the volume area scaling relationship by Yerashov. 2.4 Average Multi-Year Runoff 2.5 Annual Runoff Fluctuations Here, maybe also take a long-term view over the 20th century and even longer, by looking at e.g. Issy Kul Lake Level variations. namely the distribution of sand and loess relief types, where the former are more permeable and the latter contain more moisture↩︎ "],["05_CaseStudy_ChirchikRiver.html", "Chapter 3 Case Study - Chirchik River Basin Prerequisites 3.1 Overview 3.2 Discharge Estimation in Ungauged Subcatchments 3.3 Analysis of Available Data", " Chapter 3 Case Study - Chirchik River Basin Prerequisites This is the first ‘practical’ Chapter of the book and comes with software requirements. For the analysis of the available data we use R (R Core Team 2013). R is a computer language and environment for data analysis, statistical computation and data visualization. It can be downloaded at &lt;https://www.r-project.org&gt;. Together with R, we are using RStudio as the IDE (Team’ 2020). Some R software packages used in this Chapter need to be installed so that the analyses can be done as shown there. The installation can be done in the following way: The packages can then be loaded and made available in your R session. library(devtools) library(tidyverse) library(lubridate) library(timetk) library(DataExplorer) library(riversCentralAsia) 3.1 Overview The Chirchik is a river in the Tashkent region of Uzbekistan. Its natural basin covers 13’112 km2, not accounting for the modern-time interbasin water transfers to the neighboring Akhangaran basin in the south (the outline of the basin is shown in Figure 3.1). In terms of total runoff contribution, it is the biggest right tributary of the Syr Darya (see also further below in Section 3.3.1). The river is formed by the confluence of the Chatkal and the Pskem rivers. They emerge at the south-western end of the Tien Shan mountains, i.e. the Talas Alatau, in the border region of Kyrgyzstan, Kazakhstan and Uzbekistan. The main tributaries are in clock-wise direction starting from north: Ugam, Pskem, Kosku and Chatkal. The Charvak reservoir receives water from these rivers. Ugam is the largest right tributary downstream of the reservoir and Aksak Ata the largest left-side tributary. Below the Charvak hydroelectric power station, the river water gets diverted in numerous canals for irrigation in and around the Tashkent oasis and for interbasin water transfer to the Akhangaran basin in the south. As part of the Chirchik-Bozsuu cascade, several smaller dams along the river serve hydropower production and irrigation purposes. Figure 3.1: Overview over the Chirchik river basin with tributaries and the location of the main gauging stations in the zone of runoff formation and near the confluence with the Syr Darya. Figure 3.1 shows a comprehensive overview of the Chirchik river basin and its tributaries as well as relevant modern gauging stations. Gauges are indicated with the semi-round shapes and the corresponding five digit official code as utilized by the Uzbek Hydrometeorological Service (HydroMet) indicated. The virtual gauge is not a real gauge in the sense that reservoir inflow is calculated from all contributing tributary flow components, i.e. Chatkal river, Pskem river, Nauvalisoy and Koksu Rivers. Koksu however, with a basin area of 392 km\\(^2\\), is ungauged. So how does the HydroMet quantify its runoff contribution? 3.2 Discharge Estimation in Ungauged Subcatchments Before the closure of the Charvak dam and the subsequent filling of the reservoir in and after 1974, the HydroMet experts started a detailed 3-years measurement comparison campaign at Charvak gauge and at gauge 16279 in Khudaydod (see Figure 3.1). Both are located on Chatkal river. Charvak gauge had to be decommissioned after the closure of the dam because it got flooded. The confluence of Koksu river with Charvak river is just upstream of the former Charvak gauge. Using daily data from the measurement comparisons campaign, the HydroMet experts could then relate Charvak gauge discharge to Khudaydod discharge using a linear relationship. At the same time, they were now able to relate Koksu discharge to the discharge at Chatkal River in Khudaydod in the following manner \\[ Q_{Koksu} \\propto Q_{Charvak} - Q_{16279} \\] We show the procedure here. After loading the riversCentralAsia Package as shown above, the relevant daily data from 01/01/1965 - 31/12/1967 can be loaded. KoksuDischarge # load Data The data is stored in long format, meaning that measurements in time and for the two gauging stations are just stacked on top of each other in one long table. For the purpose here, we prefer the wide format where we have one date column with unique dates and then the data listed for each station in corresponding columns. KoksuDischarge_wide &lt;- KoksuDischarge %&gt;% pivot_wider(id_cols = &#39;date&#39;,values_from = &#39;data&#39;,names_from = &quot;code&quot;) KoksuDischarge_wide The runoff contribution of Koksu can be calculated in a simple manner. # Adding Koksu discharge to the dataframe KoksuDischarge_wide &lt;- KoksuDischarge_wide %&gt;% mutate(Koksu = Charvak - `16279`) KoksuDischarge_wide The relationship can now be visualized. # and visualize ggplot(KoksuDischarge_wide, aes(`16279`, Koksu)) + geom_point() + xlab(bquote(&#39;Discharge at Gauge 16279 Khudaydod in&#39;~m^3/s)) + ylab (bquote(&#39;Koksu river discharge in&#39;~m^3/s)) We can perform a linear regression to related discharge at Khudaydod to the one at Koksu. The coefficients of the linear regression can be obtained in the following way: lm &lt;- lm(Koksu ~ 0 + `16279`,KoksuDischarge_wide) summary(lm) ## ## Call: ## lm(formula = Koksu ~ 0 + `16279`, data = KoksuDischarge_wide) ## ## Residuals: ## Min 1Q Median 3Q Max ## -38.295 -5.867 -1.918 1.416 120.419 ## ## Coefficients: ## Estimate Std. Error t value Pr(&gt;|t|) ## `16279` 0.14469 0.00298 48.55 &lt;2e-16 *** ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 ## ## Residual standard error: 12.4 on 987 degrees of freedom ## Multiple R-squared: 0.7049, Adjusted R-squared: 0.7046 ## F-statistic: 2357 on 1 and 987 DF, p-value: &lt; 2.2e-16 Please note, in the specification of the linear model we add the 0 term to force the regression through the origin. Hence, the discharge of Koksu River can be estimated to be \\[ Q_{Koksu} = 0.145 * Q_{Khudaydod} \\] 3.3 Analysis of Available Data 3.3.1 Discharge Data The riversCentralAsia Package provides available data of the gauging and meteorological stations in the Chirchik River Basin. Once this package is loaded, we are ready to start with data analysis. ChirchikRiverBasin # load data One can get more information about the data by typing ?ChirchikRiverBasin in the console. Notice that, as above, the data are stored in long format. In other words, data from the individual stations is just stacked on top of each other. In this dataframe (called tibble in R), each row contains one time-stamped observation. Next to the data, the long-term discharge norm is stored in the tibble. The units of the data stored in the corresponding columns is stored and the data type (Q for discharge, T for temperature and P for precipitation). The station code is available as well as the station name, the river (subcatchment) and the basin name. In our case, the latter is always Chirchik. The column ‘res’ indicates the time resolution of the available data (either dec for 10-days decadal or mon for monthly). Finally, where known, the stations’ latitude and longitude, altitudes and the upstream basin size are given. There are 7 discharge stations where type = Q. These are all unique stations as can be identified by their stations codes (see above in Figure 3.1 for the station locations). We can generate timeseries plots of the river discharge data only by setting the corresponding station filter via filter(type=='Q'). data &lt;- ChirchikRiverBasin data %&gt;% filter(type==&#39;Q&#39;) %&gt;% group_by(type,code,station,resolution) %&gt;% plot_time_series(date,data,.facet_ncol = 2,.interactive = FALSE, .smooth = FALSE, .title = &#39;Available discharge data of Chirchik River Basin&#39;) The data available are near complete historic records with the discharge measurments at Gazalkent gauge starting already in 1900. The monthly record of the station is shown here in full. You can zoom into the time series and investigate it in detail. data %&gt;% filter(code==&#39;16262&#39;) %&gt;% plot_time_series(date,data, .interactive = TRUE, .smooth = FALSE, .title = &quot;Monthly discharge at Gauge 16262, Gazalkent&quot;, .x_lab = &#39;date&#39;, .y_lab = &#39;Discharge in cubic meters per second&#39;, .plotly_slider = TRUE) As is easily visible, the June 1969 discharge was the historic monthly mean maximum with 1’220 m3/s. In a similar vain, the annual timeseries can be displayed. data %&gt;% filter(code==&#39;16262&#39;) %&gt;% summarise_by_time(date,.by = &#39;year&#39;,value=sum(data,na.omit=TRUE)) %&gt;% plot_time_series(date,value, .interactive = TRUE, .title = &quot;Annual discharge at Gauge 16262, Gazalkent&quot;, .x_lab = &#39;date&#39;, .y_lab = &#39;Discharge in cubic meters per second&#39;, .smooth = FALSE) The characteristics of the timeseries feature the typical snowmelt-driven runoff pattern with pronounced seasonality and interannual variability. At Chinaz near the confluence of the Chirchik River with the Syr Darya, however, a changing discharge regime can easily be identified over time. The drastic decrease in discharge there is due to two effects. First, in the 1960ies, the upstream irrigation greatly increased together with the interbasin water transfer. Second, the closure of the Charvak dam in 1974 and the subsequent filling of the dam decreased discharge during the filling period. Furthermore, the interannual variability of flows decreased from there onwards due to the now regulated flow regime. This latter effect is also visible at the Gazalkent gauge. The non-stationarity in the discharge timeseries at these stations is thus explained by anthropogenic effects. Getting summary statistics of the gauged discharges allows us to quickly understand runoff contributions of the individual tributaries. data_stats &lt;- data %&gt;% filter(type == &#39;Q&#39;) %&gt;% dplyr::select(date,data,code) %&gt;% group_by(code) %&gt;% summarise(mean = mean(data,na.rm=TRUE), min = min(data,na.rm=TRUE), max = max(data,na.rm=TRUE), sd = sd(data,na.rm=TRUE),.groups = &#39;keep&#39;) data_stats %&gt;% ungroup() The largest left tributary to Chirchik below the Charvak reservoir Aksak Ata. The gauging station on the river got dismantled a long time ago. An average long-term mean discharge of 2.35 m\\(^{3}\\)/s is a solid estimated of its contribution to the overall discharge of Chirchik. Thus, if we add up long-term average discharge at Gazalkent and the one from Aksak Ata we obtain an annual norm discharge of 231 m\\(^{3}\\)/s. Chirchik river is thus the biggest right-tributary to the Syr Darya. Chatkal river contributes exactly half to it (115.7 m\\(^{3}\\)/s) and Pskem river approximately one third (34.4% or 79.4 m\\(^{3}\\)/s). Nauvalisoy is only a very small river with 1.6% runoff contribution (3.8 m\\(^{3}\\)/s). From the available data, the long-term average runoff contribution by the ungauged Koksu river can be estimated to be 6.4 m\\(^{3}\\)/s or 2.8%. Downstream of the reservoir, Ugam river contributes an additional 9.7% (22.4 m\\(^{3}\\)/s) to the total flow. Let us now turn our attention to the seasonality of the tributaries. We can easily investigate it using the timetk package function plot_seasonal_diagnostics(). We exclude Chinaz gauge in our analysis for the above-mentioned reason that flow there is no longer representing a natural runoff regime. First, we plot the key gauged tributaries to the Charvak reservoir, i.e. Chatkal, Pskem and Nauvalisoy rivers. data %&gt;% filter(type==&#39;Q&#39;,code!=&#39;16275&#39;,code!=&#39;16294&#39;,code!=&#39;16300&#39;,code!=&#39;16262&#39;) %&gt;% dplyr::select(date,data,code) %&gt;% group_by(code) %&gt;% plot_seasonal_diagnostics(.date_var = date,.value = data,.interactive = FALSE,.feature_set = c(&quot;week&quot;,&quot;month.lbl&quot;)) The seasonality with the spring and summer runoff peaks is striking in all three rivers. Nauvalisoy discharge peaks, on average, during or around week 20. Chatkal river discharge peaks around week 23 and Pskem river around week 26. These differences can be explained with the different mean catchment elevations where Nauvalisoy is the lowest lying and Pskem catchment the highest catchment (see also Chapter 2 for more information). Discharge seasonality of the gauging stations downstream of Charvak reservoir is shown below. Note that we only have monthly values for these stations and are thus only showing the monthly seasonality panels. data %&gt;% filter(type==&#39;Q&#39;,code!=&#39;16279&#39;,code!=&#39;16298&#39;,code!=&#39;16290&#39;,code!=&#39;16294&#39;) %&gt;% dplyr::select(date,data,code) %&gt;% group_by(code) %&gt;% plot_seasonal_diagnostics(.date_var = date,.value = data,.interactive = FALSE,.feature_set = c(&quot;month.lbl&quot;)) 3.3.2 Meteorological Data For meteorological data, we have precipitation P and temperature T data from two stations, i.e. Pskem Meteo Station, Chatkal Meteo Station. For the station at the Charvak Reservoir, we only have precipitation data. data %&gt;% filter(type!=&#39;Q&#39;) %&gt;% group_by(type,code,station,resolution) %&gt;% plot_time_series(date,data,.facet_ncol = 1,.interactive = FALSE,.smooth = FALSE) data %&gt;% filter(type==&#39;P&#39;,code==38462) %&gt;% group_by(type,code,station,resolution) %&gt;% plot_seasonal_diagnostics(date,data,.interactive = FALSE,.feature_set = c(&quot;week&quot;,&quot;month.lbl&quot;,&quot;year&quot;)) ## Warning: Removed 111 rows containing non-finite values (stat_boxplot). "],["06_PII_Retrieval_Analysis_Geo_Hydro_Data.html", "Chapter 4 Retrieval &amp; Analysis of Data Preliminary Remarks 4.1 Geospatial Data 4.2 Climate Data 4.3 Hydrological Data", " Chapter 4 Retrieval &amp; Analysis of Data Preliminary Remarks We focus on the Chirchik River as our case study (see Section 3 for background information on the river basin). The steps for preparation and processing of the required input data for modeling carry over to any other basin that you wish to focus on. First, we will discuss how to prepare and process the geospatial information of the catchment and its sub-units using the open-source Geographic Information System QGIS. Second, we deal with climate data and show how to prepare existing temperature and precipitation data from local stations and also discuss how to access, download and process climate data from reanalysis products. Finally, we prepare the available hydrological data. : Make sure this is corresponding to the section’s content. For this course, we use the open source software RS MINERVE for physically-based modeling, i.e. for numerical rainfall-runoff modeling and river routing. We then use R for empirical modeling. Hence, the steps described here focus on the input requirements of this software. It should be noted, however, that other modeling packages exist with which hydrological-hydraulic modeling can be carried out in a similar manner. These include WEAP: Water Evaluation and Planning System, SWAT: Soil &amp; Water Assessment Tool, and Mike Hydro Basin As some of these modeling packages are license-based, the advantage of using the combination of QGIS, R and RS MINERVE is that this is a completely free software suit for any user and use scenario. : Maybe revise… In the Chapter @ref(HydroModels_PhysicalModels) below, we are going to show how to then use the data retrieved and prepared in RS MINERVE for numerical water balance modeling, streamflow routing and forecasting. : Maybe a good idea would be not to spend too much time on all of this GIS work and provide the relevant GIS raster and shapefiles upfront to the students and then just walk them through how to do this. Otherwise, this ends up being a GIS course in itself. 4.1 Geospatial Data 4.1.1 Catchment Delineation Catchment delineation is the first step in geospatial analysis2. This is a step-by-sep guide on how to setup, access, organize and analyze the relevant geo-spatial data for the Chirchik River basin. It is important to mention that this workflow can be utilized in any other catchment. STEP 1 Open Empty QGIS Project Open an empty QGIS Project and set Project Coordinate Reference System (CRS) to EPSG: 32642, WGS84 / UTM 42N (see Figure 4.1). Map projections try to portray the surface of the earth, or a portion of the earth, on a flat piece of paper or computer screen. In layman’s term, map projections try to transform the earth from its spherical shape (three-dimensional or 3D) to a planar shape (two-dimensional or 2D). A CRS then defines how the 2D, projected map in your GIS relates to real places on the earth. Generally, the decision of which map projection and CRS to use depends on the regional extent of the area you want to work in, on the analysis you want to do, and often also on the availability of data. Figure 4.1: Setting the CRS of the Project to EPSG: 32642, WGS84 / UTM 42N. As mentioned above, for the Chirchik River basin case study, we use the CRS EPSG: 32642, WGS84 / UTM 42N. The UTM CRS, where UTM stands for Universal Transverse Mercator, has its origin on the equator at a specific longitude. The Y-values increase southwards and the X-values increase to the West. The UTM CRS is a global map projection and is generally used all over the world. For accuracy reasons and to avoid too much distortion, the world is divided into 60 equal zones that are all 6 degrees wide in longitude from East to West. The UTM zones are numbered 1 to 60, starting at the anti-meridian (zone 1 at 180 degrees West longitude) and progressing East back to the antemeridian (zone 60 at 180 degrees East longitude). Figure 4.1 shows a global map of UTM zones. Figure 4.2: Global map of UTM zones. See QGIS online documentation for more information. When working on a particular catchment in any region on the planet, the corresponding UTM zone should be chosen. STEP 2 Adding Groups for Project Structuring It is important to keep your geospatial data properly organized. This can be achieved by using Groups in QGIS. You should follow this recommendation and now create the following groups in the Layers Panel: RIVERS, GAUGES, BASINS, DEM, POLITICAL and Temporary3. Once you start to generate a large number of raster and vector layers, these can be conveniently organized within these Groups which act in a similar way as electronic folders on your desktop (see Figure 4.3 for an example). Figure 4.3: Background map showing the area of interest. Note the Layers grouping in the panel on the left side. The contents in the folder show the geospatial assets that will be created as part of this tutorial. STEP 3 Background Map via QuickMapServices and Political Boundaries From the main menu, select Web/QuickMapServices/Google/Google Satellite or any other suitable map of your choice. If the QuickMapServices are not available by default, you have to install the corresponding plugin. More information can be found here. If by default the Google Map Service is not available, you can install the plugin HCMGIS via the Manage and Install Plugins Menu and then access the Google base Maps via the newly appeared HCMGIS/BaseMap/ Menu. Once the background map is visible as shown in Figure 4.3, you can zoom in on the area of interest, i.e., the mountain range north-east of Tashkent at the western end of the Tien Shan mountains, where the Chirchik River originates from its tributaries. For the political shapefiles, we download the relevant country-level data from the GADM database. GADM provides spatial data for all countries and their first- and second-level subdivisions in shapefile format. It is advisable to download all first-level administrative country border data for the Central Asian Republics. Finally, make sure that you import the correct shapefile data into the corresponding group, i.e. POLITICAL, in the QGIS Folder. STEP 4 Download the Digital Elevation Model (DEM) and Administrative Country Shapefiles As a next step, select first the DEM Group in the Layers Panel on the left and then load the SRTM Downloader QGIS Plugin. Zoom in on the region of interest including and up to the point where the Chirchik joins the Syr Darya towards the southwest. Open the plugin and then select Set Canvas Extent. Like this, the coordinates of the AoI get automatically filled in. If you press ‘Download,’ all the relevant SRTM tiles get downloaded. But first, the plug-in requests you to enter your username and password of your Earthdata login4. The download progress of the individual DEM tiles can be checked in the individual asset progress bars of the SRTM Downloader plugin. As these tiles are only temporary data, there is no need to specify an explicit Output-Path (unless you want to store them for later use in which case you should choose a dedicated output path). After the download, these individual raster tiles should be merged. Select them all in a first step and then merge them with the menu option Raster / Miscellaneous / Merge. An important remark is that after merging, the individual tiles can be deleted to safe disk space. Use the Mouse Right Click / Remove Layers option to do so. To check if all went well, the resulting DEM needs to be recolored. This can be achieved through right clicking on the merged DEM and selecting Properties / Symbology. In the Layer Properties Dialogue Box, the Singleband Pseudocolor option should be selected and then a new Colormap created from the catalogue ‘cpt-city.’ You can then choose any colormap that is suitable for topography coloring. One good choice is for example wiki-schwarzwald-cont. Finally, you have to reproject the DEM to the selected CRS EPSG:32642. STEP 5 Cutting the Area of Interest (AoI), DEM Resampling and Filling Sinks The downloaded DEM file is very likely much too big and it would be great to cut it to the rough shape that we are focussing on. We just have to ensure that all of our suspected catchment area is inside the cut out. For this purpose, we add a new shapefile Layer and make sure that its Geometry Type is correctly selected as ‘Polygon.’ Ensure also, that after the creation of the layer, it again is in a Projected CRS (UTM 42N). We can then toggle editing and use the polygon creation and edit tool to roughly outline the basin (AoI) that we are focussing on. In order to roughly cutout the AoI, select Extraction / Clip Raster by Mask Layer and select the corresponding layers in the user dialog box. Figure 4.4: After Checking the resolution of the downloaded SRTM DEM, we see that cell sizes are roughly 25 meters [m] in horizontal and vertical direction. For larger catchments, it is advisable to resample the DEM to a coarser resolution. There are many ways to do this in QGIS. Here, it is proposed to use the r.resample.stats algorithm so as to decrease the resolution from 25 m to 100 m for later processing. Next, one has to ensure that sinks in the DEM are filled. First, use r.fill.dir to fill potential DEM gaps. The algorithm can be found in the Toolbox section once it is enabled in the dropdown menu Processing. Second, use r.watershed to generate the drainage direction and flow accumulation rasters. Note, it is important to specify a ‘Minimum size of exterior watershed basin’ (take 100’000) and also check the option ‘Use positive flow accumulation even for likely underestimates.’ As both, the drainage direction and flow accumulation rasters can be reused later, they should be permanently stored on disk, i.e. in the RIVERS group. STEP 6 Basin Delineation Once we have produced these rasters as described in STEP 5, we load the gauging stations if they are available as shapefiles. For each gauging station, we make sure that the gauge lies at the correct location by overlaying it with the Flow Accumulation Raster Data. If this is not the case, we need to relocate individual gauges so that they are at the correct location. This step is important so as to properly delineate the upstream area of a particular gauge under consideration. If gauges are not available as shapefiles, we can easily add a new shapefile layer and then define one or more gauges in that layer for which we want to delineate basin shapes. Ordered by their 5-digit code as administered by the Uzbek Hydrometeorological Service, the important gauges to consider are: id = 16275, name = Chinaz Gauge, river Chirchik River, lat = 4’528’236, lon = 479’463 id = 16279, name = Khudaydod Gauge, river = Chatkal River, lat = 4’596’628, lon = 598’278 id = 16290, name = Mullala Gauge, river = Pskem River, lat = 597’351, lon = 4’622’724 id = 16294, name = Virtual Gauge, river = Inflow to Charvak Reservoir, lat = 584’616, lon = 4’609’108 id = 16298, name = Sidhzak Gauge, river = Nauvalisoy River, lat = 4’618’690, lon = 589’674 id = 16300, name = Khodizhkent Gauge, river = Ugam River, lat = 4’610’070, lon = 578’612 Finally, with the algorithm r.water.outlet, and by using the Drainage Direction Map, we map those basins and get individual basin raster maps. To distinguish between the zone of runoff formation and the zone of water distribution and consumption in the larger catchment, we propose to use an artificial Gauge just below the Charvak Reservoir dam to delineate the upstream area and to then use the Geoprocessing Tool Union to merge these two polygons of upstream dam area and Ugam subcatchment into one zone of runoff formation. In principle, we are now ready to build a first rough model that does not rely on further reinfinement of the individual subcatchments. STEP 7 RIVER DELINEATION (OPTIONAL) This step is not strictly required but is simply used to define the topology of the rivers and tributaries properly. However and together with the other relevant layers, the resulting rivers shapefile can be used in the GIS Section of RS MINERVE for modeling. It can be generated easily by selecting the Flow Accumulation raster and the using the raster calculator to generate a binary 0/1 raster for the major stream segments only5. While you can experiment with arbitrary cutoff levels, a good value is 10’000. Hence, the raster calculator command to apply is ( @FlowAccumulation &gt; 10000 ) under the assumption that your flow accumulation layer is named accordingly. The resulting raster can finally be vectorized to arrive at the river network. It is advisable to perform a Vector Geometry / Fix Geometries correction on the resulting vector layer as there are likely self-intersections the processing of the layer. Once this is done, the layer can be clipped to the basin extent should this still be required. STEP 8 POLYGONIZATION OF SUBCATCHMENTS The rainfall-runoff model that we are using accounts for runoff generation processes in different contributing subcatchments. Depending on the average altitude of these, the timing and magnitude of snow- and glacier-melt contributions might highly vary throughout a hydrological year. The same is true within these individual contributing subcatchments where snow melt in lower elevations starts earlier than at higher elevations due to the negative temperature lapse rate. To account for these phased in time processes, the subcatchments can be discretized into elevation bands of a typical width. A sensible choice in the context of the Chirchik River Basin is to use elevation bands of 500 meters spacing and then model the relevant processes for each of these bands as if they were individual contributing smaller separate sub-subcatchments that dewater all to the same place. With the QGIS raster to vector option, we polygonize the basins. Check the validity of the polygon with Vector Geometry/Check Validity and correct, where necessary. 4.1.2 Computation of Elevation Bands With the reclassification algorithm, we create elevation band polygons based on the DEM layer. First, we smooth the DEM to simplify the elevation bands a bit. Then, we Reclassify by Table the DEM into the desired elevation bands. For the exercise here and given the specific topography of the basin(s) that we are interested in our Case Study, we enter manually altitude bands that are 500 meters apart (see Figure @ref{fig:ReclassificationByTable}). As output, we get a raster map with the individual elevation classes. The prepared DEM elevation levels range from 0 masl to 4’176 masl over the whole catchment. From the Figure 4.5: Reclassifying a DEM to make elevation classes that cover a range of 500 meters. Using the elevation band raster map, we use GDAL / Raster Conversion / Polygonize to create the elevation band polygons. Polygon clipping with SAGA/Vector Polygon Tool/Polygon Clipping tool to arrive and subcatchment level basins with altitude bands. Now, we have derived the required shapefiles. For importing into the rainfall-runoff model in RS MINERVE, we have to now properly prepare their attribute tables. This is a somewhat lengthy and tedious process but will help later greatly in terms of automatic model creation in RS MINERVE. RS Minerve requires the following GIS layers for the automatic translation into a rainfall-runoff model, i.e. subbasins.shp, junctions.shp and rivers.shp (see (Foehn et al. 2020) for more details). The individual feature attributes should be added either at the time of the layer creation or with the field calculator in QGIS. (#fig:RSMINERVE_GIS)Default Shapefile layers required in RS MINERVE to simplify the model topology building. See (Foehn et al. 2020) for more information. //FIXME: Check what to do with this! We note that for water supplies in the rainfall/runoff model, the focus is on the zone of runoff formation. //TODO: Add GLIMS global land ice data. STEP 9 INTEGRATION OF GLACIER DATA For the retrieval of data on land ice, we will utilize GLIMS data. 4.2 Climate Data This Section requires the following R packages to be installed. If you are running R in RStudio and some of the packages are not yet installed on your computer, RStudio will warn you and ask, whether you want to have them installed. //TODO: Suppress output below # Tidyverse library(tidyverse) # File navigation library(here) ## here() starts at /Users/tobiassiegfried/Dropbox (hydrosolutions)/1_HSOL_PROJECTS/PROJECTS/SDC/DKU_WRM_COURSE_CA/Course Materials/Handbook/Applied_Hydrological_Modeling_Bookdown # Copernicus Climate Data Store library(ecmwfr) ## ## This is &#39;ecmwfr&#39; version 1.3.0 . Please respect the terms of use: ## - https://cds.climate.copernicus.eu/disclaimer-privacy ## - https://www.ecmwf.int/en/terms-use library(keyring) # Handling netcdf files library(ncdf4) # Spatial data plotting &amp; plotting library(rgdal) ## Loading required package: sp ## rgdal: version: 1.5-18, (SVN revision 1082) ## Geospatial Data Abstraction Library extensions to R successfully loaded ## Loaded GDAL runtime: GDAL 3.1.1, released 2020/06/22 ## Path to GDAL shared files: /Library/Frameworks/R.framework/Versions/4.0/Resources/library/rgdal/gdal ## GDAL binary built with GEOS: TRUE ## Loaded PROJ runtime: Rel. 6.3.1, February 10th, 2020, [PJ_VERSION: 631] ## Path to PROJ shared files: /Library/Frameworks/R.framework/Versions/4.0/Resources/library/rgdal/proj ## Linking to sp version:1.4-4 ## To mute warnings of possible GDAL/OSR exportToProj4() degradation, ## use options(&quot;rgdal_show_exportToProj4_warnings&quot;=&quot;none&quot;) before loading rgdal. library(raster) ## ## Attaching package: &#39;raster&#39; ## The following object is masked from &#39;package:dplyr&#39;: ## ## select ## The following object is masked from &#39;package:tidyr&#39;: ## ## extract library(rgeos) ## rgeos version: 0.5-5, (SVN revision 640) ## GEOS runtime version: 3.8.1-CAPI-1.13.3 ## Linking to sp version: 1.4-2 ## Polygon checking: TRUE library(sp) library(sf) ## Linking to GEOS 3.8.1, GDAL 3.1.1, PROJ 6.3.1 library(rasterVis) ## Loading required package: lattice ## Loading required package: latticeExtra ## ## Attaching package: &#39;latticeExtra&#39; ## The following object is masked from &#39;package:ggplot2&#39;: ## ## layer library(RColorBrewer) 4.2.1 Access, Select and Download ERA5 Reanalysis Data For the climate data to be used in the modeling approach, we use ERA5 data from the European Center for Medium-Range Weather Forecasts (ECMWF, &lt;www.ecmwf.int&gt;). ERA5, the successor to ERA-Interim, provides global, hourly estimates of atmospheric variables, at a horizontal resolution of 31 km and 137 vertical levels from the surface to 0.01 hPa (Dee D. 2020). ERA5 presently extends back to 1979 but will ultimately be extended back to 19506. The ERA5 data is available via the Copernicus Climate Store at https://cds.climate.copernicus.eu. However, before we can access, select and download it there, each user has to register with a personal account in the store. For this purpose, the user should navigate to the website and register via the Login/Register/NewAccount Menu. You will receive an email once your account is ready. Log in to your account and go to your user profile where you find your user ID and API key. The relevant information should be copied and into the relevant places of the code chunk below and then be executed. #Note: replace the UID and key strings below with the proper user&#39;s information in your Copernicus Climate Data Store account. UID &lt;- &#39;UID&#39; API_key &lt;- &#39;key&#39; #This function links your password and user id for later steps wf_set_key(UID, API_key, &#39;cds&#39;) //TODO: output still showing. How to deal with it? If all worked well, you will get the following confirmation in the console: ## User UID for cds service added successfully On the Copernicus website, make sure that you are logged into your account and the navigate to Datasets. There, search for the Product ‘ERA5-Land monthly averaged data from 1981 to present’ and select it7. You end up on the products homepage where you can get more information and download the data via a form where you select the product’s type, variables, the years, months and time of day, the geographical area and, finally, the download file format of interest. Please select the following: Product type: Monthly averaged reanalysis Variable: Temperature: 2 m Temperature Lakes: NA Snow: NA Soil Water: NA Radiation and Heat: NA Evaporation and Runoff: Potential evaporation Wind, Pressure and Precipitation: Total precipitation Vegetation: NA Year: Select all Month: Select all Time: 00:00 Geographical area: Sub-region extraction (West = 65, East = 80, South = 35, North = 45) Format: NetCDF (experimental) Accept the Terms of use and press the ‘Show API request button.’ You should see the following Python request now as shown in Figure 4.6. Figure 4.6: Screenshot showing the Copernicus Data Store API request that can be copied and posted into RStudio for the convenient download of the data there. The request should be copied and pasted into RStudio into your current .Rmd file there. Select the python request with the cursor and choose ‘ECMWFR/Python to List’ under the Addins Menu. The python request will then automatically be translated into a an r command. Please check that everything is ok by comparing it with a correct request as shown below. Also, please note that we have changed the target file name by specifying target = reanalysis-era5-land-monthly-means_CentralAsia.nc. In a final step, the user can then download the data with the wf_request() function. # Here is is the resulting request in R language request &lt;- list(&quot;dataset_short_name&quot; = &quot;reanalysis-era5-land-monthly-means&quot;, format = &quot;netcdf&quot;, product_type = &quot;monthly_averaged_reanalysis&quot;, variable = c(&#39;2m_temperature&#39;, &#39;potential_evaporation&#39;, &#39;total_precipitation&#39;), year = c(&#39;1981&#39;, &#39;1982&#39;, &#39;1983&#39;, &#39;1984&#39;, &#39;1985&#39;, &#39;1986&#39;, &#39;1987&#39;, &#39;1988&#39;, &#39;1989&#39;, &#39;1990&#39;, &#39;1991&#39;, &#39;1992&#39;, &#39;1993&#39;, &#39;1994&#39;, &#39;1995&#39;, &#39;1996&#39;, &#39;1997&#39;, &#39;1998&#39;, &#39;1999&#39;, &#39;2000&#39;, &#39;2001&#39;, &#39;2002&#39;, &#39;2003&#39;, &#39;2004&#39;, &#39;2005&#39;, &#39;2006&#39;, &#39;2007&#39;, &#39;2008&#39;, &#39;2009&#39;, &#39;2010&#39;, &#39;2011&#39;, &#39;2012&#39;, &#39;2013&#39;, &#39;2014&#39;, &#39;2015&#39;, &#39;2016&#39;, &#39;2017&#39;, &#39;2018&#39;, &#39;2019&#39;, &#39;2020&#39;), month = c(&quot;01&quot;, &quot;02&quot;, &quot;03&quot;, &quot;04&quot;, &quot;05&quot;, &quot;06&quot;, &quot;07&quot;, &quot;08&quot;, &quot;09&quot;, &quot;10&quot;, &quot;11&quot;, &quot;12&quot;), time = &quot;00:00&quot;, area = &quot;45/65/35/80&quot;, #dataset = &quot;reanalysis-era5-land-monthly-means&quot;, target = &quot;reanalysis-era5-land-monthly-means_CentralAsia.nc&quot; ) # Download data as netcdf file and store it in the directory where you are running this script, this returns the path to the file ncfilelink &lt;- wf_request(user = UID, request = request, transfer = TRUE, path = here(), verbose = TRUE) ## [1] &quot;moved temporary file to -&gt; /.../reanalysis-era5-land-monthly-means_CentralAsia.nc&quot; ## [1] &quot;request purged from queue!&quot; Some Sources on NetCDF and raster files: Here are some good resources to get you started: https://pjbartlein.github.io/REarthSysSci/index.html and https://cmerow.github.io/RDataScience/05_Raster.html. 4.3 Hydrological Data //TODO: Show added value from consulting data from altimetry https://dahiti.dgfi.tum.de/en/map/ Maybe show some analysis in KNMI CLimateExplorer? Here, we largely follow a blog post by Craig Dsouza where the process of catchment delineation is nicely described (see this link for more information)↩︎ Of course, this grouping is just a suggestion and the user is free to organize spatial assets according to his/her own liking↩︎ If you do not have a login, you can create one at (https://urs.earthdata.nasa.gov//users/new){target=“_blank”}↩︎ Remember, the flow accumulation matrix entries correspond to the accumulated number of cells flowing into that particular cell (assuming equal weights for the calculation)↩︎ Although this is an extraordinary product, users still need to be aware of the limitations of reanalysis; two of the major ones are that non-physical trends and variability may be present in the record due to changes in the observing system, and that the climatologies of some variables, like surface energy fluxes, are not well represented.↩︎ The direct link is https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-land-monthly-means?tab=form.↩︎ "],["07_FirstSteps-ManualWaterBalance.html", "Chapter 5 The Manual Water Balance 5.1 Site &amp; problem description 5.2 Identification of the dominant flow processes 5.3 The general water balance equation 5.4 Boundaries of the water balance 5.5 Data need for a water balance 5.6 Setting up a conceptual model", " Chapter 5 The Manual Water Balance Although the general water balance equation is straight forward, setting up a water balance over a specific region and time period is more involved and generally requires an iterative approach. This Chapter will give you a very brief overview over the theory behind the water balance and guide you through an example to set up a regional water balance for an irrigated area in the Fergana valley. This is some example text from Tobi in your text. 5.1 Site &amp; problem description 5.2 Identification of the dominant flow processes At the start of a water balance is a preliminary estimate of the individual components of the water flow processes. These will be iteratively refined as the water balance boundaries are verified. The first estimate can be made from the office, prior to the field visit, based on open-source data and literature values. 5.2.1 Precipitation Do the ERA5 thingy ### Evaporation ### Transpiration 5.2.2 Canopy interception Neglect, literature 5.2.3 Snowmelt Neglect based on ERA5 temperature data 5.2.4 Runoff Rough estimate based on previous chapter? 5.2.5 Infiltration Rough estimates of irrigation water demand, irrigation norms, literature 5.2.6 Sub-surface flow No data, estimate with water balance 5.2.7 Sublimation Neglect, no snow 5.2.8 Percolation Neglect, shallow groundwater table 5.3 The general water balance equation In Chapter 2.2, a long-term average water balance over Central Asian mountain area has been presented. In more general terms, the water balance equals the sum of all water sources in a system to the sum of all water sinks in a system plus the change of the water storage in the system over a defined time period (Eq. (5.1)). \\[\\begin{equation} \\tag{5.1} \\sum_i \\text{Sources} = \\sum_j \\text{Sinks} + \\frac{\\Delta \\text{Storage}}{\\Delta t} \\quad, \\in \\Omega \\end{equation}\\] It is important to realize that a balance is always drawn over the well-defined boundaries of a system (\\(\\Omega\\)) and over a specified time period (\\(\\Delta t\\)). 5.4 Boundaries of the water balance Whether a flow process constitutes a source of water for a system or a sink depends on the boundaries of the system. If we calculate the water balance of the air above Central Asia, precipitation constitutes a water loss. If, on the other hand, the boundaries of the water balance are around the soil surface, precipitation is a source of water. In space and time, selection of appropriate level of abstraction 5.5 Data need for a water balance 5.6 Setting up a conceptual model "],["08_PhysicallyBased_Models.html", "Chapter 6 Hydrological Modeling: Physically-Based Models 6.1 Background on Physically-Based Modeling 6.2 Model Setup 6.3 Model Calibration and Validation 6.4 Discussion", " Chapter 6 Hydrological Modeling: Physically-Based Models 6.1 Background on Physically-Based Modeling 6.2 Model Setup 6.2.1 Zone of Runoff Formation 6.2.2 Zone of Water Distribution and Consumption 6.3 Model Calibration and Validation 6.4 Discussion "],["09_EmpiricalModels.html", "Chapter 7 Hydrological Modeling: Empirical Models 7.1 Background on Empirical Modeling 7.2 Key Forecasting Techniques 7.3 Getting Started 7.4 Exploratory Data Analysis &amp; Data Preparation", " Chapter 7 Hydrological Modeling: Empirical Models 7.1 Background on Empirical Modeling 7.2 Key Forecasting Techniques feature engineering experimentation and ensembling Knowledge of key events, i.e. date shifts holidays Deep learning (data permitting) Boosting errors 7.3 Getting Started 7.3.1 Loading the Required Packages and Data In a first step, we load all packages that are required in this Chapter to perform the analysis. Note that RStudio informs you if you have some of the packages not yet installed. If that is the case, you should click choose to install the suggested package by clicking Install. # * Course data ---- devtools::install_github(&quot;hydrosolutions/riversCentralAsia&quot;) library(riversCentralAsia) # * Forecasting Libraries ---- library(forecast) # Auto ARIMA, ETS library(rstan) library(prophet) # FB Prophet # * Machine Learning Libraries ---- library(glmnet) # Elastic Net library(earth) # Mars Regression Splines library(kernlab) # Support Vector Machine library(kknn) # K-Nearest Neighbors library(randomForest) # Random Forest library(ranger) # Random Forest library(xgboost) # Boosted Trees library(Cubist) # Cubist Rule-Based Algorithm # * Deep Learning Libraries ---- library(reticulate) # Python interface # * Time Series ML ---- library(tidymodels) # Meta - workflows, parsnip, tune, dials, recipes, rsample, yardstick library(rules) # Rule-based models (cubist) library(modeltime) # tidymodels time series extension library(modeltime.ensemble) # this is for ensemble modeling # * Core Libraries ---- library(tidyverse) # Meta - dplyr, ggplot2, purrr, tidyr, stringr, forcats library(lubridate) # date and time library(timetk) # Time series data wrangling, visualization and preprocessing # Extras library(DataExplorer) library(fs) # Kntting tables library(knitr) The riversCentralAsia Package makes selected data of the Chirchik River Basin available. These include discharge and meteorological data from the basin. Once this package is loaded, we are ready to start with data analysis. ChirchikRiverBasin # load data ?ChirchikRiverBasin data &lt;- ChirchikRiverBasin To get more information about the data, simply call the package data help documentation. ?ChirchikRiverBasin 7.4 Exploratory Data Analysis &amp; Data Preparation 7.4.1 Discharge Data There are 6 discharge stations where type = Q. These are all unique stations as can be identified by their stations codes (see above in Figure 3.1 for the station locations. We can generate timeseries plots of the river discharge data only by setting the corresponding station filter via filter(type=='Q'). data %&gt;% filter(type==&#39;Q&#39;) %&gt;% group_by(type,code,station,resolution) %&gt;% plot_time_series(date,data,.facet_ncol = 2,.interactive = FALSE, .smooth = FALSE, .title = &#39;Available discharge data of Chirchik River Basin&#39;) The characteristics of the timeseries feature the typical snowmelt-driven runoff pattern with pronounced seasonality and internannual variability. At Chinaz near the confluence of the Chirchik River with the Syr Darya, however, a changing discharge regime can easily be identified over time. The drastic decrease in discharge in the 1960ies is due to the extension of upstream irrigation and increases in interbasin water transfers. This timeseries is non-stationary for this reason and unless we not also understand the changing allocation patterns between Charvak reservoir and Chinaz gauge, it will not be possible to forecast the flow there. Getting summary statistics of the gauged discharges allows us to quickly understand runoff contributions of the individual tributaries. data %&gt;% filter(type == &#39;Q&#39;) %&gt;% dplyr::select(date,data,code) %&gt;% group_by(code) %&gt;% summarise(mean = mean(data,na.rm=TRUE), min = min(data,na.rm=TRUE), max = max(data,na.rm=TRUE), sd = sd(data,na.rm=TRUE)) ## `summarise()` ungrouping output (override with `.groups` argument) The timeseries for the two main tributaries, i.e. the Pskem River (Gauge 16290) and the Chatkal River (Gauge 16279) are almost complete decadal records from 1933 until and including 2015. We can easily get summary statistics of one discharge station by first filtering and then summarizing. The example below shows the code for Gauge 16279 at Khudaydod located in the Chatkal River Basin. data %&gt;% filter(type==&#39;Q&#39;, code==&#39;16279&#39;) %&gt;% summary() ## date data norm units type code ## Min. :1932-01-10 Min. : 21.1 Min. : 36.33 Length:3024 Q:3024 16279 :3024 ## 1st Qu.:1953-01-07 1st Qu.: 42.2 1st Qu.: 43.01 Class :character P: 0 16290 : 0 ## Median :1974-01-05 Median : 61.8 Median : 60.49 Mode :character T: 0 16924 : 0 ## Mean :1974-01-04 Mean :115.7 Mean :115.32 16298 : 0 ## 3rd Qu.:1995-01-02 3rd Qu.:154.0 3rd Qu.:174.07 16300 : 0 ## Max. :2015-12-31 Max. :729.0 Max. :327.52 16275 : 0 ## NA&#39;s :15 (Other): 0 ## station river basin resolution lon_UTM42 lat_UTM42 ## Length:3024 Length:3024 Length:3024 dec:3024 Min. :598278 Min. :4596628 ## Class :character Class :character Class :character mon: 0 1st Qu.:598278 1st Qu.:4596628 ## Mode :character Mode :character Mode :character Median :598278 Median :4596628 ## Mean :598278 Mean :4596628 ## 3rd Qu.:598278 3rd Qu.:4596628 ## Max. :598278 Max. :4596628 ## ## altitude_masl basinSize_sqkm ## Min. :953 Min. :5678 ## 1st Qu.:953 1st Qu.:5678 ## Median :953 Median :5678 ## Mean :953 Mean :5678 ## 3rd Qu.:953 3rd Qu.:5678 ## Max. :953 Max. :5678 ## ===== All discharge timeseries except the one at Chinaz look regular in the sense that they are not influenced by human activity. In all cases, significant interannual variability is visible. At Chinaz, however, it can be clearly seen that the discharge regime is changing from the 1960ies onward because of the increase of irrigation and interbasin water transfer between Charvak Reservoir and the confluence with the Syr Darya. Let us focus for the time being for the hydrological situation above Charvak dam. The reservoir receives data from different tributaries, including from Nauvalisoy, Pskem, Koksu and Chatkal rivers. All of them are gauged except Koksu River, i.e. the small catchment between Pskem and Chatkal rivers. Its contribution to runoff is estimated using an empirical relationship that was established prior to the closure of the dam. At that time, Charvak gauge was still in operation where total discharge of the Chatkal River was measured, including the one from Koksu. Hence, \\[ Q_{Koksu} \\propto Q_{Charvak Gauge} - Q_{16279} \\] The relationship was estimated using daily data over three years. is estimated through previously established empirical relationships between Chatkal dicharge For the time being, we want to focus on the zone of runoff formation and on the two main tributaries of the Chirchik River, i.e. the Chatkal and Pskem Rivers. Let us plot the two timeseries, including also the discharge data at the Charvak Reservoir at Gauge 16294. After the completion of the Charvak Reservoir dam in 1970, the original gauge got flooded and its discharge is since computed using correlations with including also their seasonal diagnostics in the following way. data %&gt;% filter(type==&#39;Q&#39;,code!=16298,code!=16275,code!=16300,code!=16294) %&gt;% group_by(type,code,station,resolution) %&gt;% plot_time_series(date,data,.facet_ncol = 1,.interactive = FALSE, .smooth = FALSE, .title = &#39;Main Tributaries of Chirchik River Basin&#39;) As is easily visible, we have a near complete record of 84 years of decadal data available for these two stations starting from 1932 until and including 2015. data %&gt;% filter(type==&#39;Q&#39;,code!=16298,code!=16275,code!=16300,code!=16294) %&gt;% group_by(type,code,station,resolution) %&gt;% plot_seasonal_diagnostics(date,data,.interactive = FALSE,.feature_set = c(&quot;week&quot;,&quot;month.lbl&quot;,&quot;year&quot;)) The summer peak discharge in the Chatkal River is, on average, 3 weeks earlier in the summer season because of the different altitude zonation and characteristics of the two catchments (see also Chapter 2 for more details). 7.4.2 Meteorological Data "],["10_EmpiricalModels.html", "Chapter 8 Hydrological Modeling: Empirical Models 8.1 Background on Empirical Modeling 8.2 Key Forecasting Techniques 8.3 Getting Started 8.4 Exploratory Data Analysis &amp; Data Preparation 8.5 Gap Filling", " Chapter 8 Hydrological Modeling: Empirical Models 8.1 Background on Empirical Modeling 8.2 Key Forecasting Techniques feature engineering experimentation and ensembling Knowledge of key events, i.e. date shifts holidays Deep learning (data permitting) Boosting errors 8.3 Getting Started 8.3.1 Loading the Required Packages and Data In a first step, we load all packages that are required in this Chapter to perform the analysis. Note that RStudio informs you if you have some of the packages not yet installed. If that is the case, you should click choose to install the suggested package by clicking Install. # * Course data ---- devtools::install_github(&quot;hydrosolutions/riversCentralAsia&quot;) library(riversCentralAsia) # * Forecasting Libraries ---- library(forecast) # Auto ARIMA, ETS library(rstan) library(prophet) # FB Prophet # * Machine Learning Libraries ---- library(glmnet) # Elastic Net library(earth) # Mars Regression Splines library(kernlab) # Support Vector Machine library(kknn) # K-Nearest Neighbors library(randomForest) # Random Forest library(ranger) # Random Forest library(xgboost) # Boosted Trees library(Cubist) # Cubist Rule-Based Algorithm # * Deep Learning Libraries ---- library(reticulate) # Python interface # * Time Series ML ---- library(tidymodels) # Meta - workflows, parsnip, tune, dials, recipes, rsample, yardstick library(rules) # Rule-based models (cubist) library(modeltime) # tidymodels time series extension library(modeltime.ensemble) # this is for ensemble modeling # * Core Libraries ---- library(tidyverse) # Meta - dplyr, ggplot2, purrr, tidyr, stringr, forcats library(lubridate) # date and time library(timetk) # Time series data wrangling, visualization and preprocessing # Extras library(DataExplorer) library(fs) # Kntting tables library(knitr) The riversCentralAsia Package makes selected data of the Chirchik River Basin available. These include discharge and meteorological data from the basin. Once this package is loaded, we are ready to start with data analysis. ChirchikRiverBasin # load data ?ChirchikRiverBasin data &lt;- ChirchikRiverBasin To get more information about the data, simply call the package data help documentation. ?ChirchikRiverBasin 8.4 Exploratory Data Analysis &amp; Data Preparation 8.4.1 Discharge Data There are 6 discharge stations where type = Q. These are all unique stations as can be identified by their stations codes (see above in Figure 3.1 for the station locations. We can generate timeseries plots of the river discharge data only by setting the corresponding station filter via filter(type=='Q'). data %&gt;% filter(type==&#39;Q&#39;) %&gt;% group_by(type,code,station,resolution) %&gt;% plot_time_series(date,data,.facet_ncol = 2,.interactive = FALSE, .smooth = FALSE, .title = &#39;Available discharge data of Chirchik River Basin&#39;) The characteristics of the timeseries feature the typical snowmelt-driven runoff pattern with pronounced seasonality and internannual variability. At Chinaz near the confluence of the Chirchik River with the Syr Darya, however, a changing discharge regime can easily be identified over time. The drastic decrease in discharge in the 1960ies is due to the extension of upstream irrigation and increases in interbasin water transfers. Getting summary statistics of the gauged discharges allows us to quickly understand runoff contributions of the individual tributaries. data %&gt;% filter(type == &#39;Q&#39;) %&gt;% dplyr::select(date,data,code) %&gt;% group_by(code) %&gt;% summarise(mean = mean(data,na.rm=TRUE), min = min(data,na.rm=TRUE), max = max(data,na.rm=TRUE), sd = sd(data,na.rm=TRUE)) %&gt;% kable(digits=1) ## `summarise()` ungrouping output (override with `.groups` argument) code mean min max sd 16279 115.7 21.1 729.0 109.9 16290 79.4 12.7 438.0 69.3 16924 205.3 40.7 1231.0 183.2 16298 3.8 0.9 21.1 2.8 16300 22.4 3.9 114.0 19.3 16275 104.9 1.2 912.0 121.0 16262 228.6 48.7 1220.0 186.4 The timeseries for the two main tributaries, i.e. the Pskem River (Gauge 16290) and the Chatkal River (Gauge 16279) are almost complete decadal records from 1933 until and including 2015. We can easily get summary statistics of one discharge station by first filtering and then summarizing. The example below shows the code for Gauge 16279 at Khudaydod located in the Chatkal River Basin. data %&gt;% filter(type==&#39;Q&#39;, code==&#39;16279&#39;) %&gt;% summary() ## date data norm units type code ## Min. :1932-01-10 Min. : 21.1 Min. : 36.33 Length:3024 Q:3024 16279 :3024 ## 1st Qu.:1953-01-07 1st Qu.: 42.2 1st Qu.: 43.01 Class :character P: 0 16290 : 0 ## Median :1974-01-05 Median : 61.8 Median : 60.49 Mode :character T: 0 16924 : 0 ## Mean :1974-01-04 Mean :115.7 Mean :115.32 16298 : 0 ## 3rd Qu.:1995-01-02 3rd Qu.:154.0 3rd Qu.:174.07 16300 : 0 ## Max. :2015-12-31 Max. :729.0 Max. :327.52 16275 : 0 ## NA&#39;s :15 (Other): 0 ## station river basin resolution lon_UTM42 lat_UTM42 ## Length:3024 Length:3024 Length:3024 dec:3024 Min. :598278 Min. :4596628 ## Class :character Class :character Class :character mon: 0 1st Qu.:598278 1st Qu.:4596628 ## Mode :character Mode :character Mode :character Median :598278 Median :4596628 ## Mean :598278 Mean :4596628 ## 3rd Qu.:598278 3rd Qu.:4596628 ## Max. :598278 Max. :4596628 ## ## altitude_masl basinSize_sqkm ## Min. :953 Min. :5678 ## 1st Qu.:953 1st Qu.:5678 ## Median :953 Median :5678 ## Mean :953 Mean :5678 ## 3rd Qu.:953 3rd Qu.:5678 ## Max. :953 Max. :5678 ## ===== All discharge timeseries except the one at Chinaz look regular in the sense that they are not influenced by human activity. In all cases, significant interannual variability is visible. At Chinaz, however, it can be clearly seen that the discharge regime is changing from the 1960ies onward because of the increase of irrigation and interbasin water transfer between Charvak Reservoir and the confluence with the Syr Darya. Let us focus for the time being for the hydrological situation above Charvak dam. The reservoir receives data from different tributaries, including from Nauvalisoy, Pskem, Koksu and Chatkal rivers. All of them are gauged except Koksu River, i.e. the small catchment between Pskem and Chatkal rivers. Its contribution to runoff is estimated using an empirical relationship that was established prior to the closure of the dam. At that time, Charvak gauge was still in operation where total discharge of the Chatkal River was measured, including the one from Koksu. Hence, \\[ Q_{Koksu} \\propto Q_{Charvak Gauge} - Q_{16279} \\] The relationship was estimated using daily data over three years. is estimated through previously established empirical relationships between Chatkal dicharge For the time being, we want to focus on the zone of runoff formation and on the two main tributaries of the Chirchik River, i.e. the Chatkal and Pskem Rivers. Let us plot the two timeseries, including also the discharge data at the Charvak Reservoir at Gauge 16294. After the completion of the Charvak Reservoir dam in 1970, the original gauge got flooded and its discharge is since computed using correlations with including also their seasonal diagnostics in the following way. data %&gt;% filter(type==&#39;Q&#39;,code!=16298,code!=16275,code!=16300,code!=16294) %&gt;% group_by(type,code,station,resolution) %&gt;% plot_time_series(date,data,.facet_ncol = 1,.interactive = FALSE, .smooth = FALSE, .title = &#39;Main Tributaries of Chirchik River Basin&#39;) As is easily visible, we have a near complete record of 84 years of decadal data available for these two stations starting from 1932 until and including 2015. data %&gt;% filter(type==&#39;Q&#39;,code!=16298,code!=16275,code!=16300,code!=16294) %&gt;% group_by(type,code,station,resolution) %&gt;% plot_seasonal_diagnostics(date,data,.interactive = FALSE,.feature_set = c(&quot;week&quot;,&quot;month.lbl&quot;,&quot;year&quot;)) The summer peak discharge in the Chatkal River is, on average, 3 weeks earlier in the summer season because of the different altitude zonation and characteristics of the two catchments (see also Chapter 2 for more details). 8.4.2 Meteorological Data For meteorological data, we have precipitation P and temperature T data from two stations, i.e. Pskem Meteo Station, Chatkal Meteo Station. For the station at the Charvak Reservoir, we only have precipitation data. data %&gt;% filter(type!=&#39;Q&#39;) %&gt;% group_by(type,code,station,resolution) %&gt;% plot_time_series(date,data,.facet_ncol = 1,.interactive = FALSE,.smooth = FALSE) data %&gt;% filter(type==&#39;P&#39;,code==38462) %&gt;% group_by(type,code,station,resolution) %&gt;% plot_seasonal_diagnostics(date,data,.interactive = FALSE,.feature_set = c(&quot;week&quot;,&quot;month.lbl&quot;,&quot;year&quot;)) ## Warning: Removed 111 rows containing non-finite values (stat_boxplot). 8.5 Gap Filling "],["10_Operationalization.html", "Chapter 9 Operationalization of Models - Opportunities and Challenges 9.1 Co-design Phase 9.2 Modeling Phase 9.3 Testing Phase 9.4 Operational Deployment", " Chapter 9 Operationalization of Models - Opportunities and Challenges 9.1 Co-design Phase 9.2 Modeling Phase 9.3 Testing Phase 9.4 Operational Deployment "],["11_Appendix_Software.html", "Chapter 10 (APPENDIX) Appendix Chapter 11 Appendix A 11.1 Open-Source Software", " Chapter 10 (APPENDIX) Appendix Chapter 11 Appendix A 11.1 Open-Source Software 11.1.1 QGIS 11.1.2 R and RStudio 11.1.3 RS Minerve "],["12_references.html", "Chapter 12 References", " Chapter 12 References Aizen, V B, E M Aizen, and V A Kuzmichonok. 2007. “Glaciers and Hydrological Changes in the Tien Shan: Simulation and Prediction.” Environmental Research Letters 2 (4): 045019. https://doi.org/10.1088/1748-9326/2/4/045019. Central Intelligence Agency. n.d. “The World Factbook 2020.” https://www.cia.gov/library/publications/resources/the-world-factbook/index.html. Dee D., National Center for Atmospheric Research Staff. 2020. “The Climate Data Guide: Era5 Atmospheric Reanalysis.” https://climatedataguide.ucar.edu/climate-data/era5-atmospheric-reanalysis. Foehn, A., J. Garcia Hernandez, B. Roquier, J. Fluixa-Sanmartin, T. Brauchli, J. Paredes Arquiola, and G. De Cesare. 2020. “RS MINERVE - User Manual, V2.15.” ISSN 2673-2653. Switzerland: Ed. CREALP. Gerlitz, Lars, Eva Steirou, Christoph Schneider, Vincent Moron, Sergiy Vorogushyn, and Bruno Merz. 2018. “Variability of the Cold Season Climate in Central Asia. Part I: Weather Types and Their Tropical and Extratropical Drivers.” Journal of Climate 31 (18): 7185–7207. https://doi.org/10.1175/jcli-d-17-0715.1. GLIMS, and NSIDC. 2005, updated 2018. Global Land Ice Measurements from Space Glacier Database. Compiled and made available by the international GLIMS community and the National Snow and Ice Data Center, Boulder CO, U.S.A. DOI:10.7265/N5V98602. Pravilova, Ekaterina. 2009. “River of Empire: Geopolitics, Irrigation, and the Amu Darya in the Late XIXth Century.” Cahiers d’Asie Centrale 17/18: 255–87. R Core Team. 2013. R: A Language and Environment for Statistical Computing. Vienna, Austria: R Foundation for Statistical Computing. http://www.R-project.org/. Shults, Victor. 1965. Rivers of Middle Asia. 2nd Edition. Gidrometeoizdat, Leningrad. “Srtmgl1 n -ASA SRTM Version 3.0.” 2020. https://earthdata.nasa.gov/learn/articles/nasa-shuttle-radar-topography-mission-srtm-version-3-0-global-1-arc-second-data-released-over-asia-and-australia. Team’, ’RStudio. 2020. RStudio: Integrated Development Environment for r. Boston, MA: RStudio, PBC. "]]
